C51 COMPILER V9.60.0.0   ROT                                                               05/29/2020 16:57:55 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE ROT
OBJECT MODULE PLACED IN .\Objects\rot.obj
COMPILER INVOKED BY: D:\Eng-Software\Keil_v5\core\C51\BIN\C51.EXE rot.c LARGE OMF2 OPTIMIZE(8,SPEED) BROWSE MODP2 DEBUG 
                    -PRINT(.\Listings\rot.lst) TABS(2) OBJECT(.\Objects\rot.obj)

line level    source

   1          #include <STC89C5xRC.H>
   2          #include <stdlib.h>
   3          #include "rot.h"
   4          //
   5          #include "lcd.h"
   6          #include "habit.h"
   7          #include "delay.h"
   8          #include "bmp.h"
   9          #include "temps.h"
  10          #include "test.h"
  11          #include "ds1302.h"
  12          #include "button.h"
  13          #include "dht11.h"
  14          #include "calendar.h"
  15          #include "zk.h"
  16          #include "Uart.h"
  17          #include "jq8900.h"
  18          #include "game.h"
  19          
  20          //
  21          
  22          #define Clr_menuScreen if(menuRefreshSign!=menuCode){lcd_clr_DDram  ();lcd_clr_GD ();menuRefreshSign=menuCo
             -de;}
  23          
  24          #define tasksTotalNum 6
  25          
  26          uint rot_timeBase=1 ;//1~10000
  27          //uchar rot_timebutton_ms=0 ;//0~9
  28          
  29          uint rot_taskCounter[tasksTotalNum]={0};//任务计时器
  30          uchar rot_taskTrigger[tasksTotalNum]={0};//任务触发器
  31          
  32          uint rot_taskFrequency[tasksTotalNum]={100,100,10,100,5,50};//任务间隔
  33          
  34          uchar task0_operating_status=0;//任务分步0: 输入,1:等待,2: 读取
  35          uchar task0_operating_status_timing=0;//0~10
  36          
  37          uchar rot_character[]={"星期年月日一二\xC8\xFD四五六七八九十"};
  38          extern uchar ver_key[4][8];
  39          
  40          uchar c_day=10;
  41          
  42          /************MENU***********/
  43          uchar data menuCode=0;
  44          
  45          uchar menuRefreshSign=0;
  46          
  47          uchar SwitchFlag[]={0,0};
  48          uchar SwitchFlag_sign[]={0,0};
  49          
  50          //uchar backDrop[16];
  51          
  52          uchar DisplayOffset=0;
  53          //uchar DisplayOffset_old;
C51 COMPILER V9.60.0.0   ROT                                                               05/29/2020 16:57:55 PAGE 2   

  54          uchar OptionCode_old[]={0,10,10};
  55          uchar OptionSite=0;
  56          uchar OptionSite_old=0;
  57          uchar OptionSite_old_Direction=0;
  58          uchar Option_count=0;//用于子菜单检测
  59          
  60          uchar Sensor_switch[2]={1,1};
  61          uint Sensor_display_switchingSpeed=520;
  62          uint Sensor_display_switchingTimer=520;
  63          
  64          /*闹钟*/
  65          #define TotalNumber_alarms 4
  66          //控制
  67          uchar AlarmClockNum=0;
  68          uchar AlarmClockNum_old=0;
  69          uchar AlarmOptionSite=0;
  70          uchar AlarmOptionSite_old=0;
  71          //数据
  72          uchar AlarmDat[TotalNumber_alarms][9]={
  73          {0,0,0,0,20,1,1,0,0},
  74          {0,0,0,0,20,1,1,0,0},
  75          {0,0,0,0,20,1,1,0,0},
  76          {0,0,0,0,20,1,1,0,0}
  77          };
  78          uint clock_time_delay[TotalNumber_alarms]={0,0,0,0};
  79          
  80          uchar AlarmClockMusicSet[TotalNumber_alarms]={1,2,3,4};
  81          
  82          //music
  83          uchar Jq_Counter=0;
  84          uchar Jq_Counter_clock=0;
  85          uchar Jq_Shunt=0;
  86          uchar Jq_SecOld=0;
  87          uchar Jq_CheckPermission=1;
  88          uchar  Jq_Counter_clock2=0;
  89          uchar Jq_IntelligentErrorCorrectionCount=0;
  90          uchar Jq_SmartCorrection_Sec=0;
  91          //uchar MusicTaskStatus[4]={0,0,0,0};
  92          //uchar MusicPlayerDat[3]={0,0,20};
  93          //uint  MusicPlayerSpecifiedDat=0;
  94          //uchar Music_TimingTaskTiming=0;
  95          extern uchar UartError;
  96          
  97          uchar JqSoundOption=10;
  98          uchar JqSoundOptionOld=10;
  99          uchar JqHourlyTimeSwitch=0;
 100          uchar DsHourOld;
 101          
 102          uchar BootInterfaceDisplayTime=50;//10为1s;
 103          
 104          uchar i,j,k;
 105          
 106          uchar gameSpeed=10;
 107          uchar gameSpeedSet=10;
 108          uchar gametime=0;
 109          uchar gamedatcache[2];
 110          uchar gameFPS=0;
 111          uchar gameFPS_counter=0;
 112          
 113          uchar moreMenuCode=1;
 114          uchar moreMenuRefreshSign=1;
 115          uchar moreFunctionsOption=0;
C51 COMPILER V9.60.0.0   ROT                                                               05/29/2020 16:57:55 PAGE 3   

 116          uchar moreFunctionsOptionOld=0;
 117          uchar gameSnakeOption=0;
 118          uchar gameSnakeOptionOld=0;
 119          uchar gameSnakeSetOption=10;
 120          uchar gameSnakeSetOptionOld=10;
 121          //uchar gameSnakeOptionCode=0;
 122          
 123          void Time0_init()
 124          {
 125   1        TMOD |=0x01;//设置定时器0为工作方式1（M1 M0为01）
 126   1        TL0 = 0x00;   //设置定时初值
 127   1        TH0 = 0xB8;   //设置定时初值
 128   1        EA=1;//开总中断
 129   1        ET0=1;//开定时器0中断
 130   1        TR0=1;//启动定时器
 131   1        
 132   1      }
 133          
 134          void rot_init()
 135          {
 136   1        Time0_init();
 137   1        Uart_Init ();
 138   1        
 139   1        //Ds18b20_Init();
 140   1        //Ds1302_Set_time();
 141   1        Ds1302_init();
 142   1        lcd_init();
 143   1        lcd_clr_DDram ();
 144   1        lcd_clr_GD ();
 145   1        //d_n_ms(200);
 146   1        JqSpecify_volume(0x1a);
 147   1        menuCode=255;//进入开机界面
 148   1      }
 149          
 150          //void MusicPlayer()
 151          //{
 152          //  if(Music_TimingTaskTiming==0){JqQueryCmd(2);Music_TimingTaskTiming=1;}//进入执行
 153          //  
 154          //  
 155          //  
 156          //  //触发执行
 157          //  if(MusicTaskStatus[3]&&(TiBUSY==0)&&(RiBUSY==0)){JqPlaySpecifiedTrack(MusicPlayerSpecifiedDat);MusicTas
             -kStatus[3]=0;}//播放指定曲目0~65535
 158          //  if(MusicTaskStatus[2]&&(TiBUSY==0)&&(RiBUSY==0)){JqSpecify_volume(MusicPlayerDat[2]);MusicTaskStatus[2]
             -=0;}//指定音量
 159          //  if(MusicTaskStatus[1]&&(TiBUSY==0)&&(RiBUSY==0)){JqSetLoopMode(MusicPlayerDat[1]);MusicTaskStatus[1]=0;
             -}//指令    ：00：全盘循环，01：单曲循环，02：单曲停止 03：全盘随机，04：目录循环，05：目录随机  06：目录顺序，07：全盘顺序
 160          //  if(MusicTaskStatus[0]&&(TiBUSY==0)&&(RiBUSY==0)){JqPlayCmd(MusicPlayerDat[0]);MusicTaskStatus[0]=0;}//0
             -2:播放，03：暂停，04：停止，05：上一曲，06：下一曲
 161          //  //定时执行//低优先级
 162          //  if((TiBUSY==0)&&(RiBUSY==0)&&(Music_TimingTaskTiming==1)){JqQueryCmd(7);if(Music_TimingTaskTiming<3)Mus
             -ic_TimingTaskTiming++;else Music_TimingTaskTiming=1;}
 163          //  if((TiBUSY==0)&&(RiBUSY==0)&&(Music_TimingTaskTiming==2)){JqQueryCmd(1);if(Music_TimingTaskTiming<3)Mus
             -ic_TimingTaskTiming++;else Music_TimingTaskTiming=1;}
 164          //  if((TiBUSY==0)&&(RiBUSY==0)&&(Music_TimingTaskTiming==3)){JqQueryCmd(0);if(Music_TimingTaskTiming<3)Mus
             -ic_TimingTaskTiming++;else Music_TimingTaskTiming=1;}
 165          //  
 166          //}
 167          
 168          void AlarmClock_trigger()
 169          {
 170   1        uchar i,j;
C51 COMPILER V9.60.0.0   ROT                                                               05/29/2020 16:57:55 PAGE 4   

 171   1        
 172   1        for(i=0;i<4;i++)
 173   1        {
 174   2          
 175   2          if(AlarmDat[i][0]==1)
 176   2          {
 177   3            if(!AlarmDat[i][8])
 178   3            {
 179   4              if(AlarmDat[i][4]==((ds_dat_time[6]>>4)*10+(ds_dat_time[6]&0x0f)))
 180   4                if(AlarmDat[i][5]==((ds_dat_time[4]>>4)*10+(ds_dat_time[4]&0x0f)))
 181   4                  if(AlarmDat[i][6]==((ds_dat_time[3]>>4)*10+(ds_dat_time[3]&0x0f)))
 182   4                    if(AlarmDat[i][1]==((ds_dat_time[2]>>4)*10+(ds_dat_time[2]&0x0f)))
 183   4                      if(AlarmDat[i][2]==((ds_dat_time[1]>>4)*10+(ds_dat_time[1]&0x0f)))
 184   4                        if(AlarmDat[i][3]==((ds_dat_time[0]>>4)*10+(ds_dat_time[0]&0x0f)))
 185   4                        {AlarmDat[i][0]=2;clock_time_delay[i]=0;}//JpAlarmMusic(i);
 186   4            }
 187   3            if(AlarmDat[i][8])  
 188   3              for(j=0;j<7;j++)
 189   3                if(((AlarmDat[i][7]>>(7-j))&0x01))
 190   3                  if(AlarmDat[i][1]==((ds_dat_time[2]>>4)*10+(ds_dat_time[2]&0x0f)))
 191   3                    if(AlarmDat[i][2]==((ds_dat_time[1]>>4)*10+(ds_dat_time[1]&0x0f)))
 192   3                      if(AlarmDat[i][3]==((ds_dat_time[0]>>4)*10+(ds_dat_time[0]&0x0f)))
 193   3                      {AlarmDat[i][0]=3;clock_time_delay[i]=0;}//JpAlarmMusic(i);
 194   3        
 195   3          //if(!(clock_time_delay[0]%120))JpAlarmMusic(0);
 196   3          }
 197   2      
 198   2        }
 199   1      
 200   1        
 201   1      }
 202          
 203          void Calculation()
 204          {
 205   1        if((ds_dat_time[3]!=c_day)||(menuRefreshSign!=menuCode)&&menuCode==0)
 206   1        {
 207   2          Conversion(0,ds_dat_time[6],ds_dat_time[4],ds_dat_time[3]);cale_data_transfer();
 208   2          CalculateWeek(20,ds_dat_time[6],ds_dat_time[4],ds_dat_time[3]);
 209   2          c_day=ds_dat_time[3];
 210   2          
 211   2        }
 212   1      }
 213          
 214          void screenOutput()
 215          {
 216   1        //uchar i;
 217   1        uchar dat[6]={0,0,0,0,0,0};
 218   1        switch(menuCode)
 219   1        {
 220   2          case 0:{
 221   3            if(menuRefreshSign!=menuCode){lcd_clr_DDram ();lcd_clr_GD ();menuRefreshSign=menuCode;}
 222   3            lcd_wcmd(0x30);
 223   3            lcd_wcmd(0x80);
 224   3            lcd_wdat('2');lcd_wdat('0');
 225   3            lcd_wdat((ds_dat_time[6]>>4)+48);lcd_wdat((ds_dat_time[6]&0x0f)+48);lcd_wdat('-');
 226   3            lcd_wdat((ds_dat_time[4]>>4)+48);lcd_wdat((ds_dat_time[4]&0x0f)+48);lcd_wdat('-');
 227   3            lcd_wdat((ds_dat_time[3]>>4)+48);lcd_wdat((ds_dat_time[3]&0x0f)+48);
 228   3            if(AlarmDat[0][0]||AlarmDat[1][0]||AlarmDat[2][0]||AlarmDat[3][0])lcd_Draw_PM(5,0,2,16,nz);
 229   3            else lcd_Draw_PM_dat2(5,0,1,16,0x00,0x00);
 230   3            if(sun_week==1)lcd_ch_display(0,6,"周一");
 231   3            if(sun_week==2)lcd_ch_display(0,6,"周二");
 232   3            if(sun_week==3)lcd_ch_display(0,6,"周\xC8\xFD");//三
C51 COMPILER V9.60.0.0   ROT                                                               05/29/2020 16:57:55 PAGE 5   

 233   3            if(sun_week==4)lcd_ch_display(0,6,"周四");
 234   3            if(sun_week==5)lcd_ch_display(0,6,"周五");
 235   3            if(sun_week==6)lcd_ch_display(0,6,"周六");
 236   3            if(sun_week==0||sun_week==7)lcd_ch_display(0,6,"周日");
 237   3            if(SwitchFlag[1]==0)
 238   3            {
 239   4            lcd_Draw_PM(0,16,2,32,num16321[ds_dat_time[2]>>4]);
 240   4            lcd_Draw_PM(1,16,2,32,num16321[ds_dat_time[2]&0x0f]);
 241   4            lcd_Draw_PM(2,16,2,32,num16321[10]);
 242   4            lcd_Draw_PM(3,16,2,32,num16321[ds_dat_time[1]>>4]);
 243   4            lcd_Draw_PM(4,16,2,32,num16321[ds_dat_time[1]&0x0f]);
 244   4            lcd_Draw_PM(5,16,2,32,num16321[10]);
 245   4            lcd_Draw_PM(6,16,2,32,num16321[ds_dat_time[0]>>4]);
 246   4            lcd_Draw_PM(7,16,2,32,num16321[ds_dat_time[0]&0x0f]);
 247   4            }
 248   3            if(SwitchFlag[1]==1)
 249   3            {
 250   4            lcd_Draw_PM(0,16,2,32,num16322[ds_dat_time[2]>>4]);
 251   4            lcd_Draw_PM(1,16,2,32,num16322[ds_dat_time[2]&0x0f]);
 252   4            lcd_Draw_PM(2,16,2,32,num16322[10]);
 253   4            lcd_Draw_PM(3,16,2,32,num16322[ds_dat_time[1]>>4]);
 254   4            lcd_Draw_PM(4,16,2,32,num16322[ds_dat_time[1]&0x0f]);
 255   4            lcd_Draw_PM(5,16,2,32,num16322[10]);
 256   4            lcd_Draw_PM(6,16,2,32,num16322[ds_dat_time[0]>>4]);
 257   4            lcd_Draw_PM(7,16,2,32,num16322[ds_dat_time[0]&0x0f]);
 258   4            }
 259   3            if(SwitchFlag[1]==2)
 260   3            {
 261   4            lcd_Draw_PM(0,16,2,32,num16323[ds_dat_time[2]>>4]);
 262   4            lcd_Draw_PM(1,16,2,32,num16323[ds_dat_time[2]&0x0f]);
 263   4            lcd_Draw_PM(2,16,2,32,num16323[10]);
 264   4            lcd_Draw_PM(3,16,2,32,num16323[ds_dat_time[1]>>4]);
 265   4            lcd_Draw_PM(4,16,2,32,num16323[ds_dat_time[1]&0x0f]);
 266   4            lcd_Draw_PM(5,16,2,32,num16323[10]);
 267   4            lcd_Draw_PM(6,16,2,32,num16323[ds_dat_time[0]>>4]);
 268   4            lcd_Draw_PM(7,16,2,32,num16323[ds_dat_time[0]&0x0f]);
 269   4            }
 270   3            if(SwitchFlag[1]==3)
 271   3            {
 272   4            lcd_Draw_PM(0,16,2,32,num16324[ds_dat_time[2]>>4]);
 273   4            lcd_Draw_PM(1,16,2,32,num16324[ds_dat_time[2]&0x0f]);
 274   4            lcd_Draw_PM(2,16,2,32,num16324[10]);
 275   4            lcd_Draw_PM(3,16,2,32,num16324[ds_dat_time[1]>>4]);
 276   4            lcd_Draw_PM(4,16,2,32,num16324[ds_dat_time[1]&0x0f]);
 277   4            lcd_Draw_PM(5,16,2,32,num16324[10]);
 278   4            lcd_Draw_PM(6,16,2,32,num16324[ds_dat_time[0]>>4]);
 279   4            lcd_Draw_PM(7,16,2,32,num16324[ds_dat_time[0]&0x0f]);
 280   4            }
 281   3            
 282   3            if(moon_month==1)lcd_ch_display(3,0,"\xD5\xFD");
 283   3            if(moon_month==2)lcd_ch_display(3,0,"二");
 284   3            if(moon_month==3)lcd_ch_display(3,0,"\xC8\xFD");
 285   3            if(moon_month==4)lcd_ch_display(3,0,"四");
 286   3            if(moon_month==5)lcd_ch_display(3,0,"五");
 287   3            if(moon_month==6)lcd_ch_display(3,0,"六");
 288   3            if(moon_month==7)lcd_ch_display(3,0,"七");
 289   3            if(moon_month==8)lcd_ch_display(3,0,"八");
 290   3            if(moon_month==9)lcd_ch_display(3,0,"九");
 291   3            if(moon_month==0x10)lcd_ch_display(3,0,"十");
 292   3            if(moon_month==0x11)lcd_ch_display(3,0,"冬");
 293   3            if(moon_month==0x12)lcd_ch_display(3,0,"腊");
 294   3            lcd_ch_display(3,1,"月");
C51 COMPILER V9.60.0.0   ROT                                                               05/29/2020 16:57:55 PAGE 6   

 295   3            if(moon_day==0x1){lcd_ch_display(3,2,"初一");}
 296   3            if(moon_day==0x2){lcd_ch_display(3,2,"初二");}
 297   3            if(moon_day==0x3){lcd_ch_display(3,2,"初\xC8\xFD");}
 298   3            if(moon_day==0x4){lcd_ch_display(3,2,"初四");}
 299   3            if(moon_day==0x5){lcd_ch_display(3,2,"初五");}
 300   3            if(moon_day==0x6){lcd_ch_display(3,2,"初六");}
 301   3            if(moon_day==0x7){lcd_ch_display(3,2,"初七");}
 302   3            if(moon_day==0x8){lcd_ch_display(3,2,"初八");}
 303   3            if(moon_day==0x9){lcd_ch_display(3,2,"初九");}
 304   3            if(moon_day==0x10){lcd_ch_display(3,2,"初十");}
 305   3            if(moon_day==0x11){lcd_ch_display(3,2,"十一");}
 306   3            if(moon_day==0x12){lcd_ch_display(3,2,"十二");}
 307   3            if(moon_day==0x13){lcd_ch_display(3,2,"十\xC8\xFD");}
 308   3            if(moon_day==0x14){lcd_ch_display(3,2,"十四");}
 309   3            if(moon_day==0x15){lcd_ch_display(3,2,"十五");}
 310   3            if(moon_day==0x16){lcd_ch_display(3,2,"十六");}
 311   3            if(moon_day==0x17){lcd_ch_display(3,2,"十七");}
 312   3            if(moon_day==0x18){lcd_ch_display(3,2,"十八");}
 313   3            if(moon_day==0x19){lcd_ch_display(3,2,"十九");}
 314   3            if(moon_day==0x20){lcd_ch_display(3,2,"二十");}
 315   3            if(moon_day==0x21){lcd_ch_display(3,2,"廿一");}
 316   3            if(moon_day==0x22){lcd_ch_display(3,2,"廿二");}
 317   3            if(moon_day==0x23){lcd_ch_display(3,2,"廿\xC8\xFD");}
 318   3            if(moon_day==0x24){lcd_ch_display(3,2,"廿四");}
 319   3            if(moon_day==0x25){lcd_ch_display(3,2,"廿五");}
 320   3            if(moon_day==0x26){lcd_ch_display(3,2,"廿六");}
 321   3            if(moon_day==0x27){lcd_ch_display(3,2,"廿七");}
 322   3            if(moon_day==0x28){lcd_ch_display(3,2,"廿八");}
 323   3            if(moon_day==0x29){lcd_ch_display(3,2,"廿九");}
 324   3            if(moon_day==0x30){lcd_ch_display(3,2,"\xC8\xFD十");}
 325   3            if((!Sensor_switch[1])&&(!Sensor_switch[0])||SwitchFlag[0]==2)
 326   3            {
 327   4              if(SwitchFlag[0]!=SwitchFlag_sign[0]){lcd_Draw_PM_dat(4,48,8,16,0x00);lcd_ch_display(3,4,"        ");S
             -witchFlag_sign[0]=SwitchFlag[0];}     
 328   4              
 329   4              if((moon_year%10)==0)lcd_ch_display(3,4,"\xB8\xFD");//天干
 330   4              if((moon_year%10)==1)lcd_ch_display(3,4,"辛");
 331   4              if((moon_year%10)==2)lcd_ch_display(3,4,"壬");
 332   4              if((moon_year%10)==3)lcd_ch_display(3,4,"癸");
 333   4              if((moon_year%10)==4)lcd_ch_display(3,4,"甲");
 334   4              if((moon_year%10)==5)lcd_ch_display(3,4,"乙");
 335   4              if((moon_year%10)==6)lcd_ch_display(3,4,"丙");
 336   4              if((moon_year%10)==7)lcd_ch_display(3,4,"丁");
 337   4              if((moon_year%10)==8)lcd_ch_display(3,4,"戊");
 338   4              if((moon_year%10)==9)lcd_ch_display(3,4,"己");
 339   4              
 340   4              if((moon_year%12)==0)lcd_ch_display(3,5,"辰");//地支
 341   4              if((moon_year%12)==1)lcd_ch_display(3,5,"巳");
 342   4              if((moon_year%12)==2)lcd_ch_display(3,5,"午");
 343   4              if((moon_year%12)==3)lcd_ch_display(3,5,"未");
 344   4              if((moon_year%12)==4)lcd_ch_display(3,5,"申");
 345   4              if((moon_year%12)==5)lcd_ch_display(3,5,"酉");
 346   4              if((moon_year%12)==6)lcd_ch_display(3,5,"戌");
 347   4              if((moon_year%12)==7)lcd_ch_display(3,5,"亥");
 348   4              if((moon_year%12)==8)lcd_ch_display(3,5,"子");
 349   4              if((moon_year%12)==9)lcd_ch_display(3,5,"丑");
 350   4              if((moon_year%12)==10)lcd_ch_display(3,5,"寅");
 351   4              if((moon_year%12)==11)lcd_ch_display(3,5,"卯");
 352   4              
 353   4              if((moon_year%12)==0)lcd_ch_display(3,6,"龙");//地支
 354   4              if((moon_year%12)==1)lcd_ch_display(3,6,"蛇");
 355   4              if((moon_year%12)==2)lcd_ch_display(3,6,"马");
C51 COMPILER V9.60.0.0   ROT                                                               05/29/2020 16:57:55 PAGE 7   

 356   4              if((moon_year%12)==3)lcd_ch_display(3,6,"羊");
 357   4              if((moon_year%12)==4)lcd_ch_display(3,6,"猴");
 358   4              if((moon_year%12)==5)lcd_ch_display(3,6,"鸡");
 359   4              if((moon_year%12)==6)lcd_ch_display(3,6,"狗");
 360   4              if((moon_year%12)==7)lcd_ch_display(3,6,"猪");
 361   4              if((moon_year%12)==8)lcd_ch_display(3,6,"鼠");
 362   4              if((moon_year%12)==9)lcd_ch_display(3,6,"牛");
 363   4              if((moon_year%12)==10)lcd_ch_display(3,6,"虎");
 364   4              if((moon_year%12)==11)lcd_ch_display(3,6,"兔");
 365   4              lcd_ch_display(3,7,"年");
 366   4            }
 367   3      
 368   3            if((SwitchFlag[0]==0||(!Sensor_switch[1])&&SwitchFlag[0]==1)&&Sensor_switch[0])
 369   3            {
 370   4              if(SwitchFlag[0]!=SwitchFlag_sign[0]){lcd_Draw_PM_dat(4,48,8,16,0x00);lcd_ch_display(3,4,"        ");S
             -witchFlag_sign[0]=SwitchFlag[0];}
 371   4              lcd_Draw_PM(4,48,2,16,wdj);
 372   4              lcd_wcmd(0x30);
 373   4              lcd_wcmd(0x9d);
 374   4              if(temp_data_Integer/100%10)lcd_wdat(temp_data_Integer/100%10+48);
 375   4              lcd_wdat(temp_data_Integer/10%10+48);
 376   4              lcd_wdat(temp_data_Integer%10+48);
 377   4              if(!(temp_data_Integer/100%10)){lcd_wdat('.');lcd_wdat(temp_data_Decimal_r%10+48);}
 378   4              lcd_ch_display(3,7,"℃");
 379   4              //lcd_Draw_PM(7,48,2,16,wd);
 380   4            }
 381   3            if((SwitchFlag[0]==1||(!Sensor_switch[0])&&SwitchFlag[0]==0)&&Sensor_switch[1])
 382   3            {
 383   4              if(SwitchFlag[0]!=SwitchFlag_sign[0]){lcd_Draw_PM_dat(4,48,8,16,0x00);lcd_ch_display(3,4,"        ");S
             -witchFlag_sign[0]=SwitchFlag[0];}
 384   4      
 385   4              lcd_Draw_PM(4,48,2,16,shd);
 386   4              if(Dht_RhData[0]!=100)lcd_ch_display(3,5,"\xA1\xEF");//填充空位
 387   4              lcd_wcmd(0x30);
 388   4              if(Dht_RhData[0]!=100)lcd_wcmd(0x9e);else {lcd_wcmd(0x9d);lcd_wdat(' ');lcd_wdat('1');}//100%
 389   4              lcd_wdat(Dht_RhData[0]/10%10+48);
 390   4              lcd_wdat(Dht_RhData[0]%10+48);
 391   4      //        lcd_wdat('.');//小数没有数据
 392   4      //        lcd_wdat(Dht_RhData[1]+48);
 393   4              lcd_Draw_PM(7,48,2,16,bfb);
 394   4            }
 395   3            break;
 396   3          }
 397   2          case 1:
 398   2          { 
 399   3            if(menuRefreshSign!=menuCode){
 400   4              lcd_clr_DDram ();lcd_clr_GD ();menuRefreshSign=menuCode;
 401   4              DisplayOffset=0;OptionCode_old[0]=0;OptionSite=0;OptionSite_old=0;
 402   4            }
 403   3            lcd_ch_display(0,0,"功");
 404   3            lcd_ch_display(1,0,"能");
 405   3            lcd_ch_display(2,0,"菜");
 406   3            lcd_ch_display(3,0,"单");
 407   3            lcd_wcmd(0x87);lcd_wdat(OptionCode[0]+48);
 408   3            lcd_Draw_PM_dat2(0,0,1,64,0xff,0xfe);
 409   3            //光标
 410   3            if(OptionCode[0]>OptionCode_old[0])
 411   3            {
 412   4              if(OptionCode[0]<3)OptionSite=OptionCode[0]*16;
 413   4              else if(OptionCode[0]<(OptionCode_Max[0]))OptionSite=32;
 414   4              else OptionSite=48;
 415   4              OptionSite_old_Direction=0;
C51 COMPILER V9.60.0.0   ROT                                                               05/29/2020 16:57:55 PAGE 8   

 416   4            }
 417   3            if(OptionCode[0]<OptionCode_old[0])
 418   3            {
 419   4              if(OptionCode[0]>(OptionCode_Max[0]-3))OptionSite=48-(OptionCode_Max[0]-OptionCode[0])*16;
 420   4              else if(OptionCode[0]>0) OptionSite=16;
 421   4              else OptionSite=0;
 422   4              OptionSite_old_Direction=1;
 423   4            }
 424   3            OptionCode_old[0]=OptionCode[0];
 425   3            if(OptionSite!=OptionSite_old)
 426   3            {
 427   4            lcd_Draw_PM_dat2(1,0,5,64,0x00,0x00);
 428   4            OptionSite_old=OptionSite;
 429   4            }
 430   3            
 431   3            switch(OptionCode_old[0])
 432   3            {
 433   4              case 0:lcd_Draw_PM_dat2(1,OptionSite,4,16,0xff,0xff);lcd_Draw_PM_dat2(5,OptionSite,1,16,0x00,0x00);bre
             -ak;
 434   4              case 2:lcd_Draw_PM_dat2(1,OptionSite,4,16,0xff,0xff);lcd_Draw_PM_dat2(5,OptionSite,1,16,0x00,0x00);bre
             -ak;
 435   4              case 4:lcd_Draw_PM_dat2(1,OptionSite,4,16,0xff,0xff);lcd_Draw_PM_dat2(5,OptionSite,1,16,0x00,0x00);bre
             -ak;
 436   4      //        case 5:lcd_Draw_PM_dat2(1,OptionSite,4,16,0xff,0xff);lcd_Draw_PM_dat2(5,OptionSite,1,16,0xff,0x00);b
             -reak;
 437   4      //        case 6:lcd_Draw_PM_dat2(1,OptionSite,4,16,0xff,0xff);lcd_Draw_PM_dat2(5,OptionSite,1,16,0xff,0x00);b
             -reak;
 438   4              case 5:lcd_Draw_PM_dat2(1,OptionSite,4,16,0xff,0xff);lcd_Draw_PM_dat2(5,OptionSite,1,16,0x00,0x00);bre
             -ak;
 439   4              case 6:lcd_Draw_PM_dat2(1,OptionSite,4,16,0xff,0xff);lcd_Draw_PM_dat2(5,OptionSite,1,16,0x00,0x00);bre
             -ak;
 440   4              default:lcd_Draw_PM_dat2(1,OptionSite,5,16,0xff,0xff);break;
 441   4            }
 442   3      //      lcd_Draw_PM_dat2(1,OptionSite,5,16,0xff,0xff);
 443   3            
 444   3            //进度条
 445   3            lcd_scrollBar(7,3,62,7,OptionCode[0]);
 446   3            
 447   3            //选单
 448   3            DisplayOffset=0;
 449   3            if((OptionCode_old[0]<2)&&OptionSite_old_Direction                  ||(OptionCode_old[0]<3)&&(!OptionSite_old_Di
             -rection)){lcd_ch_display(DisplayOffset,5,"  ");lcd_ch_display(DisplayOffset++,1,"设置时间  ");}
 450   3            if((OptionCode_old[0]<3)&&OptionSite_old_Direction                  ||(OptionCode_old[0]<4)&&(!OptionSite_old_Di
             -rection))lcd_ch_display(DisplayOffset++,1,"传感器设置");
 451   3            if((OptionCode_old[0]<4)&&OptionSite_old_Direction                  ||(OptionCode_old[0]<5)&&(!OptionSite_old_Di
             -rection))lcd_ch_display(DisplayOffset++,1,"闹钟设置  ");
 452   3            if(                                 OptionSite_old_Direction||                (!OptionSite_old_Direction))lcd_ch_display(Displa
             -yOffset++,1,"音频播放器");
 453   3            if(                 (OptionCode_old[0]>1)&&OptionSite_old_Direction||(OptionCode_old[0]<7)&&(OptionCode_old[0]>
             -2)&&(!OptionSite_old_Direction))lcd_ch_display(DisplayOffset++,1,"声音设置  ");
 454   3            if(                 (OptionCode_old[0]>2)&&OptionSite_old_Direction||(OptionCode_old[0]<8)&&(OptionCode_old[0]>
             -3)&&(!OptionSite_old_Direction))lcd_ch_display(DisplayOffset++,1,"关于设备  ");
 455   3            if(                 (OptionCode_old[0]>3)&&OptionSite_old_Direction||(OptionCode_old[0]<9)&&(OptionCode_old[0]>
             -4)&&(!OptionSite_old_Direction))lcd_ch_display(DisplayOffset++,1,"附加功能  ");
 456   3      //      if(                 (OptionCode[0]>4)&&OptionSite_old_Direction||(OptionCode[0]<10)&&(OptionCode[0]>5)&&(!Opt
             -ionSite_old_Direction))lcd_ch_display(DisplayOffset++,1,"功能选项7");
 457   3      //      if(                 (OptionCode[0]>5)&&OptionSite_old_Direction||(OptionCode[0]<11)&&(OptionCode[0]>6)&&(!Opt
             -ionSite_old_Direction))lcd_ch_display(DisplayOffset++,1,"功能选项8");
 458   3      //      if(                 (OptionCode[0]>6)&&OptionSite_old_Direction||(OptionCode[0]<12)&&(OptionCode[0]>7)&&(!Opt
             -ionSite_old_Direction))lcd_ch_display(DisplayOffset++,1,"功能选项9");
 459   3            break;
 460   3          }
C51 COMPILER V9.60.0.0   ROT                                                               05/29/2020 16:57:55 PAGE 9   

 461   2          
 462   2          case 10:
 463   2          { if(menuRefreshSign!=menuCode){lcd_clr_DDram ();lcd_clr_GD ();menuRefreshSign=menuCode;Ds1302_time_Copy
             -(0);OptionCode[1]=10;Option_count=0;}
 464   3            //lcd_ch_display(0,0,"功能子菜单");lcd_Draw_PM_dat(0,0,10,16,0xff);
 465   3            if(OptionCode[1]==10)Ds1302_time_Copy(0);
 466   3            lcd_ch_display(0,0,"设");
 467   3            lcd_ch_display(1,0,"置");
 468   3            lcd_ch_display(2,0,"时");
 469   3            lcd_ch_display(3,0,"间");
 470   3            
 471   3            lcd_wcmd(0x30);lcd_wcmd(0x81);
 472   3            lcd_wdat((ds_dat_time_set[2]>>4)+48);lcd_wdat((ds_dat_time_set[2]&0x0f)+48);lcd_wdat(':');
 473   3            lcd_wdat((ds_dat_time_set[1]>>4)+48);lcd_wdat((ds_dat_time_set[1]&0x0f)+48);lcd_wdat(':');
 474   3            lcd_wdat((ds_dat_time_set[0]>>4)+48);lcd_wdat((ds_dat_time_set[0]&0x0f)+48);
 475   3            lcd_Draw_PM_dat2(0,0,1,64,0xff,0xfe);
 476   3            lcd_wcmd(0x30);lcd_wcmd(0x91);
 477   3            lcd_wdat('2');lcd_wdat('0');
 478   3            lcd_wdat((ds_dat_time_set[6]>>4)+48);lcd_wdat((ds_dat_time_set[6]&0x0f)+48);lcd_wdat('-');
 479   3            lcd_wdat((ds_dat_time_set[4]>>4)+48);lcd_wdat((ds_dat_time_set[4]&0x0f)+48);lcd_wdat('-');
 480   3            lcd_wdat((ds_dat_time_set[3]>>4)+48);lcd_wdat((ds_dat_time_set[3]&0x0f)+48);
 481   3            
 482   3      
 483   3            
 484   3            
 485   3            ds_dat_time_set[5]=CalculateWeek(20,ds_dat_time_set[6],ds_dat_time_set[4],ds_dat_time_set[3]);
 486   3            if(ds_dat_time_set[5]==1)lcd_ch_display(2,6,"周一");
 487   3            if(ds_dat_time_set[5]==2)lcd_ch_display(2,6,"周二");
 488   3            if(ds_dat_time_set[5]==3)lcd_ch_display(2,6,"周\xC8\xFD");//三
 489   3            if(ds_dat_time_set[5]==4)lcd_ch_display(2,6,"周四");
 490   3            if(ds_dat_time_set[5]==5)lcd_ch_display(2,6,"周五");
 491   3            if(ds_dat_time_set[5]==6)lcd_ch_display(2,6,"周六");
 492   3            if(ds_dat_time_set[5]==0||ds_dat_time_set[5]==7)lcd_ch_display(2,6,"周日");
 493   3            
 494   3            Conversion(0,ds_dat_time_set[6],ds_dat_time_set[4],ds_dat_time_set[3]);
 495   3            //lcd_wcmd(0x30);lcd_wcmd(0x8b);lcd_wdat((cale_moon_year>>4)+48);lcd_wdat((cale_moon_year&0x0f)+48);
 496   3            cale_moon_year=(cale_moon_year>>4)*10+(cale_moon_year&0x0f);
 497   3            
 498   3            if((cale_moon_year%10)==0)lcd_ch_display(3,1,"\xB8\xFD");//天干
 499   3            if((cale_moon_year%10)==1)lcd_ch_display(3,1,"辛");
 500   3            if((cale_moon_year%10)==2)lcd_ch_display(3,1,"壬");
 501   3            if((cale_moon_year%10)==3)lcd_ch_display(3,1,"癸");
 502   3            if((cale_moon_year%10)==4)lcd_ch_display(3,1,"甲");
 503   3            if((cale_moon_year%10)==5)lcd_ch_display(3,1,"乙");
 504   3            if((cale_moon_year%10)==6)lcd_ch_display(3,1,"丙");
 505   3            if((cale_moon_year%10)==7)lcd_ch_display(3,1,"丁");
 506   3            if((cale_moon_year%10)==8)lcd_ch_display(3,1,"戊");
 507   3            if((cale_moon_year%10)==9)lcd_ch_display(3,1,"己");
 508   3            
 509   3            if((cale_moon_year%12)==0)lcd_ch_display(3,2,"辰");//地支
 510   3            if((cale_moon_year%12)==1)lcd_ch_display(3,2,"巳");
 511   3            if((cale_moon_year%12)==2)lcd_ch_display(3,2,"午");
 512   3            if((cale_moon_year%12)==3)lcd_ch_display(3,2,"未");
 513   3            if((cale_moon_year%12)==4)lcd_ch_display(3,2,"申");
 514   3            if((cale_moon_year%12)==5)lcd_ch_display(3,2,"酉");
 515   3            if((cale_moon_year%12)==6)lcd_ch_display(3,2,"戌");
 516   3            if((cale_moon_year%12)==7)lcd_ch_display(3,2,"亥");
 517   3            if((cale_moon_year%12)==8)lcd_ch_display(3,2,"子");
 518   3            if((cale_moon_year%12)==9)lcd_ch_display(3,2,"丑");
 519   3            if((cale_moon_year%12)==10)lcd_ch_display(3,2,"寅");
 520   3            if((cale_moon_year%12)==11)lcd_ch_display(3,2,"卯");
 521   3            
C51 COMPILER V9.60.0.0   ROT                                                               05/29/2020 16:57:55 PAGE 10  

 522   3            if((cale_moon_year%12)==0)lcd_ch_display(2,1,"龙");//地支
 523   3            if((cale_moon_year%12)==1)lcd_ch_display(2,1,"蛇");
 524   3            if((cale_moon_year%12)==2)lcd_ch_display(2,1,"马");
 525   3            if((cale_moon_year%12)==3)lcd_ch_display(2,1,"羊");
 526   3            if((cale_moon_year%12)==4)lcd_ch_display(2,1,"猴");
 527   3            if((cale_moon_year%12)==5)lcd_ch_display(2,1,"鸡");
 528   3            if((cale_moon_year%12)==6)lcd_ch_display(2,1,"狗");
 529   3            if((cale_moon_year%12)==7)lcd_ch_display(2,1,"猪");
 530   3            if((cale_moon_year%12)==8)lcd_ch_display(2,1,"鼠");
 531   3            if((cale_moon_year%12)==9)lcd_ch_display(2,1,"牛");
 532   3            if((cale_moon_year%12)==10)lcd_ch_display(2,1,"虎");
 533   3            if((cale_moon_year%12)==11)lcd_ch_display(2,1,"兔");
 534   3            lcd_ch_display(3,3,"年");
 535   3            if(cale_moon_month==1)lcd_ch_display(3,4,"\xD5\xFD");
 536   3            if(cale_moon_month==2)lcd_ch_display(3,4,"二");
 537   3            if(cale_moon_month==3)lcd_ch_display(3,4,"\xC8\xFD");
 538   3            if(cale_moon_month==4)lcd_ch_display(3,4,"四");
 539   3            if(cale_moon_month==5)lcd_ch_display(3,4,"五");
 540   3            if(cale_moon_month==6)lcd_ch_display(3,4,"六");
 541   3            if(cale_moon_month==7)lcd_ch_display(3,4,"七");
 542   3            if(cale_moon_month==8)lcd_ch_display(3,4,"八");
 543   3            if(cale_moon_month==9)lcd_ch_display(3,4,"九");
 544   3            if(cale_moon_month==0x10)lcd_ch_display(3,4,"十");
 545   3            if(cale_moon_month==0x11)lcd_ch_display(3,4,"冬");
 546   3            if(cale_moon_month==0x12)lcd_ch_display(3,4,"腊");
 547   3            lcd_ch_display(3,5,"月");
 548   3            if(cale_moon_day==0x1){lcd_ch_display(3,6,"初一");}
 549   3            if(cale_moon_day==0x2){lcd_ch_display(3,6,"初二");}
 550   3            if(cale_moon_day==0x3){lcd_ch_display(3,6,"初\xC8\xFD");}
 551   3            if(cale_moon_day==0x4){lcd_ch_display(3,6,"初四");}
 552   3            if(cale_moon_day==0x5){lcd_ch_display(3,6,"初五");}
 553   3            if(cale_moon_day==0x6){lcd_ch_display(3,6,"初六");}
 554   3            if(cale_moon_day==0x7){lcd_ch_display(3,6,"初七");}
 555   3            if(cale_moon_day==0x8){lcd_ch_display(3,6,"初八");}
 556   3            if(cale_moon_day==0x9){lcd_ch_display(3,6,"初九");}
 557   3            if(cale_moon_day==0x10){lcd_ch_display(3,6,"初十");}
 558   3            if(cale_moon_day==0x11){lcd_ch_display(3,6,"十一");}
 559   3            if(cale_moon_day==0x12){lcd_ch_display(3,6,"十二");}
 560   3            if(cale_moon_day==0x13){lcd_ch_display(3,6,"十\xC8\xFD");}
 561   3            if(cale_moon_day==0x14){lcd_ch_display(3,6,"十四");}
 562   3            if(cale_moon_day==0x15){lcd_ch_display(3,6,"十五");}
 563   3            if(cale_moon_day==0x16){lcd_ch_display(3,6,"十六");}
 564   3            if(cale_moon_day==0x17){lcd_ch_display(3,6,"十七");}
 565   3            if(cale_moon_day==0x18){lcd_ch_display(3,6,"十八");}
 566   3            if(cale_moon_day==0x19){lcd_ch_display(3,6,"十九");}
 567   3            if(cale_moon_day==0x20){lcd_ch_display(3,6,"二十");}
 568   3            if(cale_moon_day==0x21){lcd_ch_display(3,6,"廿一");}
 569   3            if(cale_moon_day==0x22){lcd_ch_display(3,6,"廿二");}
 570   3            if(cale_moon_day==0x23){lcd_ch_display(3,6,"廿\xC8\xFD");}
 571   3            if(cale_moon_day==0x24){lcd_ch_display(3,6,"廿四");}
 572   3            if(cale_moon_day==0x25){lcd_ch_display(3,6,"廿五");}
 573   3            if(cale_moon_day==0x26){lcd_ch_display(3,6,"廿六");}
 574   3            if(cale_moon_day==0x27){lcd_ch_display(3,6,"廿七");}
 575   3            if(cale_moon_day==0x28){lcd_ch_display(3,6,"廿八");}
 576   3            if(cale_moon_day==0x29){lcd_ch_display(3,6,"廿九");}
 577   3            if(cale_moon_day==0x30){lcd_ch_display(3,6,"\xC8\xFD十");}
 578   3            
 579   3            if((OptionCode_old[1]!=OptionCode[1])||Option_count==0)
 580   3            {
 581   4              lcd_Draw_PM_dat2(1,0,5,64,0x00,0x00);
 582   4              Option_count=1;
 583   4              switch(OptionCode[1])
C51 COMPILER V9.60.0.0   ROT                                                               05/29/2020 16:57:55 PAGE 11  

 584   4              {
 585   5                case 0:lcd_Draw_PM_dat2(1,0,1,16,0xff,0xff);break;
 586   5                case 1:lcd_Draw_PM_dat2(2,0,1,16,0x00,0xff);lcd_Draw_PM_dat2(3,0,1,16,0xff,0x00);break;
 587   5                case 2:lcd_Draw_PM_dat2(4,0,1,16,0xff,0xff);break;
 588   5                case 3:lcd_Draw_PM_dat2(2,16,1,16,0xff,0xff);break;
 589   5                case 4:lcd_Draw_PM_dat2(3,16,1,16,0x00,0xff);lcd_Draw_PM_dat2(4,16,1,16,0xff,0x00);break;
 590   5                case 5:lcd_Draw_PM_dat2(5,16,1,16,0xff,0xff);break;
 591   5              }
 592   4              OptionCode_old[1]=OptionCode[1];
 593   4            }
 594   3            break;
 595   3          }
 596   2          case 100:
 597   2          {
 598   3            if(menuRefreshSign!=menuCode){lcd_clr_DDram ();lcd_clr_GD ();menuRefreshSign=menuCode;}
 599   3            lcd_ch_display(1,0,"时间发生变动！！");
 600   3            lcd_ch_display(2,0,"是否确认更改？");
 601   3            break;
 602   3          }
 603   2          case 11:
 604   2          {if(menuRefreshSign!=menuCode){lcd_clr_DDram  ();lcd_clr_GD ();menuRefreshSign=menuCode;
 605   4            
 606   4            lcd_Draw_PM_dat2(3,0,1,64,0x00,0x01);
 607   4            lcd_Draw_PM_dat2(5,0,1,48,0x00,0x01);
 608   4            lcd_Draw_PM_dat2(7,0,1,64,0x00,0x01);
 609   4            lcd_Draw_PM_dat2(4,48,4,1,0xff,0xff);
 610   4          
 611   4          }
 612   3            //lcd_ch_display(0,0,"功能子菜单");lcd_Draw_PM_dat(0,0,10,16,0xff);
 613   3            lcd_ch_display(0,0,"传");
 614   3            lcd_ch_display(1,0,"感");
 615   3            lcd_ch_display(2,0,"器");
 616   3            lcd_Draw_PM_dat2(0,0,1,48,0xff,0xfe);
 617   3          
 618   3        /*    lcd_Draw_PM_dat2(1,0,5,64,0x00,0x00);
 619   3            lcd_Draw_PM_dat2(3,0,1,64,0x00,0x01);
 620   3            lcd_Draw_PM_dat2(5,0,1,48,0x00,0x01);
 621   3            lcd_Draw_PM_dat2(7,0,1,64,0x00,0x01);
 622   3            lcd_Draw_PM_dat2(4,48,4,1,0xff,0xff);*/
 623   3            lcd_ch_display(0,4,"温度");lcd_ch_display(0,6,"湿度");
 624   3            lcd_ch_display(1,2,"开关");
 625   3            lcd_ch_display(2,2,"刷新");
 626   3            lcd_ch_display(3,2,"切换");
 627   3            if(Sensor_switch[0])lcd_ch_display(1,4,"YES");else lcd_ch_display(1,4,"NO");
 628   3            if(Sensor_switch[1])lcd_ch_display(1,6,"YES");else lcd_ch_display(1,6,"NO");
 629   3            lcd_wcmd(0x30);lcd_wcmd(0x8c);
 630   3            lcd_wdat((uchar)(rot_taskFrequency[0]/1000%10+48));lcd_wdat((uchar)(rot_taskFrequency[0]/100%10+48));lc
             -d_ch_display(2,5,"秒");
 631   3            lcd_wdat((uchar)(rot_taskFrequency[1]/1000%10+48));lcd_wdat((uchar)(rot_taskFrequency[1]/100%10+48));lc
             -d_ch_display(2,7,"秒");
 632   3            if(Sensor_switch[0])lcd_ch_display(1,4,"YES");else lcd_ch_display(1,4,"NO ");
 633   3            if(Sensor_switch[1])lcd_ch_display(1,6,"YES");else lcd_ch_display(1,6,"NO ");
 634   3            lcd_wcmd(0x9d);lcd_wdat((uchar)(Sensor_display_switchingSpeed/1000%10+48));lcd_wdat((uchar)(Sensor_disp
             -lay_switchingSpeed/100%10+48));lcd_ch_display(3,6,"秒");
 635   3            if((OptionCode_old[2]!=OptionCode[2]))
 636   3            {
 637   4              lcd_Draw_PM_dat2(1,0,7,64,0x00,0x00);
 638   4              lcd_Draw_PM_dat2(3,0,1,64,0x00,0x01);
 639   4              lcd_Draw_PM_dat2(5,0,1,48,0x00,0x01);
 640   4              lcd_Draw_PM_dat2(7,0,1,64,0x00,0x01);
 641   4              lcd_Draw_PM_dat2(4,48,4,1,0xff,0xff);
 642   4              //Option_count=1;
C51 COMPILER V9.60.0.0   ROT                                                               05/29/2020 16:57:55 PAGE 12  

 643   4              switch(OptionCode[2])
 644   4              {
 645   5                case 0:lcd_Draw_PM_dat2(4,17,1,14,0xff,0xff);lcd_Draw_PM_dat2(5,17,1,14,0xff,0x01);break;
 646   5                case 1:lcd_Draw_PM_dat2(6,17,1,14,0xff,0xff);lcd_Draw_PM_dat2(7,17,1,14,0xff,0x01);break;
 647   5                case 2:lcd_Draw_PM_dat2(4,33,1,14,0xff,0xff);break;
 648   5                case 3:lcd_Draw_PM_dat2(6,33,1,14,0xff,0xff);break;
 649   5                case 4:lcd_Draw_PM_dat2(5,49,1,14,0xff,0xff);break;
 650   5              }
 651   4              OptionCode_old[2]=OptionCode[2];
 652   4            }
 653   3          break;
 654   3          }
 655   2          case 12:
 656   2          {
 657   3            if(menuRefreshSign!=menuCode){lcd_clr_DDram ();lcd_clr_GD ();menuRefreshSign=menuCode;AlarmClockNum=10;
             -AlarmClockNum_old=AlarmClockNum;}
 658   3            lcd_ch_display(0,0,"闹");
 659   3            lcd_ch_display(1,0,"钟");
 660   3            lcd_ch_display(2,0,"设");
 661   3            lcd_ch_display(3,0,"置");
 662   3            lcd_Draw_PM_dat2(0,0,1,64,0xff,0xfe);
 663   3            
 664   3            lcd_ch_display(0,1,"clock: 1 2 3 4");
 665   3            if(AlarmClockNum<4)
 666   3            {
 667   4              //lcd_wcmd(0x30);lcd_wcmd(0x91);lcd_wdat(AlarmClockNum-1);//lcd_wdat(' ');
 668   4              if(AlarmDat[AlarmClockNum][0]==0)lcd_ch_display(1,1,"  关");else lcd_ch_display(1,1,"  开");
 669   4              if(AlarmDat[AlarmClockNum][8]==0)lcd_ch_display(2,1,"Data:");else lcd_ch_display(2,1,"Week:");
 670   4              lcd_wcmd(0x30);lcd_wcmd(0x94);
 671   4              lcd_wdat(AlarmDat[AlarmClockNum][1]/10+48);
 672   4              lcd_wdat(AlarmDat[AlarmClockNum][1]%10+48);
 673   4              lcd_wdat(':');
 674   4              lcd_wdat(AlarmDat[AlarmClockNum][2]/10+48);
 675   4              lcd_wdat(AlarmDat[AlarmClockNum][2]%10+48);
 676   4              lcd_wdat(':');
 677   4              lcd_wdat(AlarmDat[AlarmClockNum][3]/10+48);
 678   4              lcd_wdat(AlarmDat[AlarmClockNum][3]%10+48);
 679   4              if(AlarmDat[AlarmClockNum][8]==0)
 680   4              {
 681   5              lcd_Draw_PM_dat2(1,63,7,1,0x00,0x00); 
 682   5              lcd_wcmd(0x30);lcd_wcmd(0x99);
 683   5              lcd_wdat(' ');lcd_wdat(' ');lcd_wdat(' ');lcd_wdat(' ');
 684   5              lcd_wdat('2');lcd_wdat('0');
 685   5              lcd_wdat(AlarmDat[AlarmClockNum][4]/10+48);
 686   5              lcd_wdat(AlarmDat[AlarmClockNum][4]%10+48);
 687   5              lcd_wdat('-');
 688   5              lcd_wdat(AlarmDat[AlarmClockNum][5]/10+48);
 689   5              lcd_wdat(AlarmDat[AlarmClockNum][5]%10+48);
 690   5              lcd_wdat('-');
 691   5              lcd_wdat(AlarmDat[AlarmClockNum][6]/10+48);
 692   5              lcd_wdat(AlarmDat[AlarmClockNum][6]%10+48);
 693   5              }
 694   4              else 
 695   4              {
 696   5                lcd_ch_display(3,1,"一二\xC8\xFD\xCB\xC4\xCE\xE5\xC1\xF9\xC8\xD5");
 697   5                if((AlarmDat[AlarmClockNum][7]>>7)&0x01)lcd_Draw_PM_dat2(1,63,1,1,0x15,0x50);else lcd_Draw_PM_dat2(1,
             -63,1,1,0x00,0x00);
 698   5                if((AlarmDat[AlarmClockNum][7]>>6)&0x01)lcd_Draw_PM_dat2(2,63,1,1,0x15,0x50);else lcd_Draw_PM_dat2(2,
             -63,1,1,0x00,0x00);
 699   5                if((AlarmDat[AlarmClockNum][7]>>5)&0x01)lcd_Draw_PM_dat2(3,63,1,1,0x15,0x50);else lcd_Draw_PM_dat2(3,
             -63,1,1,0x00,0x00);
 700   5                if((AlarmDat[AlarmClockNum][7]>>4)&0x01)lcd_Draw_PM_dat2(4,63,1,1,0x15,0x50);else lcd_Draw_PM_dat2(4,
C51 COMPILER V9.60.0.0   ROT                                                               05/29/2020 16:57:55 PAGE 13  

             -63,1,1,0x00,0x00);
 701   5                if((AlarmDat[AlarmClockNum][7]>>3)&0x01)lcd_Draw_PM_dat2(5,63,1,1,0x15,0x50);else lcd_Draw_PM_dat2(5,
             -63,1,1,0x00,0x00);
 702   5                if((AlarmDat[AlarmClockNum][7]>>2)&0x01)lcd_Draw_PM_dat2(6,63,1,1,0x15,0x50);else lcd_Draw_PM_dat2(6,
             -63,1,1,0x00,0x00);
 703   5                if((AlarmDat[AlarmClockNum][7]>>1)&0x01)lcd_Draw_PM_dat2(7,63,1,1,0x15,0x50);else lcd_Draw_PM_dat2(7,
             -63,1,1,0x00,0x00);
 704   5              }
 705   4            }
 706   3            
 707   3            if(AlarmClockNum!=AlarmClockNum_old)
 708   3            {
 709   4              AlarmClockNum_old=AlarmClockNum;
 710   4              if(AlarmClockNum_old<4)lcd_Draw_PM_dat2(1,0,7,64,0x00,0x00);
 711   4              lcd_Draw_PM_dat2(4+AlarmClockNum,0,1,16,0x0f,0xff);
 712   4            }
 713   3            if(AlarmOptionSite!=AlarmOptionSite_old)
 714   3            {
 715   4              AlarmOptionSite_old=AlarmOptionSite;
 716   4              lcd_Draw_PM_dat2(1,16,7,47,0x00,0x00);
 717   4              if(AlarmOptionSite>0&&AlarmClockNum<4)
 718   4              {
 719   5                switch(AlarmOptionSite)
 720   5                {
 721   6                  case 1:lcd_Draw_PM_dat2(2,16,1,16,0xff,0xfe);break;
 722   6                  case 2:lcd_Draw_PM_dat2(4,16,1,16,0xff,0xff);break;
 723   6                  case 3:lcd_Draw_PM_dat2(5,16,1,16,0x00,0xff);lcd_Draw_PM_dat2(6,16,1,16,0xff,0x00);break;
 724   6                  case 4:lcd_Draw_PM_dat2(7,16,1,16,0xff,0xff);break;
 725   6                  case 5:lcd_Draw_PM_dat2(1,32,2,16,0xff,0xff);break;
 726   6                  case 6:if(!AlarmDat[AlarmClockNum][8])lcd_Draw_PM_dat2(4,48,1,15,0xff,0xff);else lcd_Draw_PM_dat2(1,
             -48,1,15,0xff,0xfe);break;
 727   6                  case 7:if(!AlarmDat[AlarmClockNum][8]){lcd_Draw_PM_dat2(5,48,1,15,0x00,0xff);lcd_Draw_PM_dat2(6,48,1
             -,15,0xff,0x00);}else lcd_Draw_PM_dat2(2,48,1,15,0xff,0xfe);break;
 728   6                  case 8:if(!AlarmDat[AlarmClockNum][8])lcd_Draw_PM_dat2(7,48,1,15,0xff,0xff);else lcd_Draw_PM_dat2(3,
             -48,1,15,0xff,0xfe);break;
 729   6                  case 9:lcd_Draw_PM_dat2(4,48,1,15,0xff,0xfe);break;
 730   6                  case 10:lcd_Draw_PM_dat2(5,48,1,15,0xff,0xfe);break;
 731   6                  case 11:lcd_Draw_PM_dat2(6,48,1,15,0xff,0xfe);break;
 732   6                  case 12:lcd_Draw_PM_dat2(7,48,1,15,0xff,0xfe);break;
 733   6                }
 734   5                
 735   5              }
 736   4            }
 737   3            break;
 738   3          }
 739   2          case 13:
 740   2          {if(menuRefreshSign!=menuCode){lcd_clr_DDram();lcd_clr_GD();menuRefreshSign=menuCode;UartError=0x00;JqQu
             -eryCmd(2);Jq_Counter_clock=0;PS=1;}
 741   3            lcd_ch_display(0,0,"播");
 742   3            lcd_ch_display(1,0,"放");
 743   3            lcd_ch_display(2,0,"器");
 744   3            lcd_Draw_PM_dat2(0,0,1,49,0xff,0xfe);
 745   3      //      lcd_ch_display(3,0,"VOL:");
 746   3            lcd_ch_display(0,4,"曲目");
 747   3          
 748   3            lcd_wcmd(0x30);
 749   3            lcd_wcmd(0x86);
 750   3      //uchar RiPlaybackStatus;//播放状态
 751   3      //uchar RiTotalTrackTlaybackTime[3];//曲目总时间，时分秒
 752   3      //uchar RiCurrentPlayingTime[3];//曲目已播放时间
 753   3      //uchar RiTotalTrack[2];//总曲目
 754   3      //uchar RiCurrentTrack[2];//当前曲目
C51 COMPILER V9.60.0.0   ROT                                                               05/29/2020 16:57:55 PAGE 14  

 755   3            lcd_wdat(':');lcd_wdat(RiCurrentTrack/100%10+48);
 756   3            lcd_wdat(RiCurrentTrack/10%10+48);lcd_wdat(RiCurrentTrack%10+48);
 757   3            lcd_wcmd(0x94);
 758   3            lcd_wdat(RiCurrentPlayingTime[0]/10+48);lcd_wdat(RiCurrentPlayingTime[0]%10+48);lcd_wdat(':');
 759   3            lcd_wdat(RiCurrentPlayingTime[1]/10+48);lcd_wdat(RiCurrentPlayingTime[1]%10+48);lcd_wdat(':');
 760   3            lcd_wdat(Jq_SmartCorrection_Sec/10+48);lcd_wdat(Jq_SmartCorrection_Sec%10+48);
 761   3            lcd_wcmd(0x8c);
 762   3            lcd_wdat(RiTotalTrackTlaybackTime[0]/10+48);lcd_wdat(RiTotalTrackTlaybackTime[0]%10+48);lcd_wdat(':');
 763   3            lcd_wdat(RiTotalTrackTlaybackTime[1]/10+48);lcd_wdat(RiTotalTrackTlaybackTime[1]%10+48);lcd_wdat(':');
 764   3            lcd_wdat(RiTotalTrackTlaybackTime[2]/10+48);lcd_wdat(RiTotalTrackTlaybackTime[2]%10+48);
 765   3            lcd_wcmd(0x98);
 766   3            lcd_wdat((UartError>>7)+48);lcd_wdat(((UartError>>6)&0x01)+48);lcd_wdat(((UartError>>5)&0x01)+48);
 767   3            lcd_wdat(((UartError>>4)&0x01)+48);
 768   3            lcd_wdat(((UartError>>3)&0x01)+48);lcd_wdat(((UartError>>2)&0x01)+48);lcd_wdat(((UartError>>1)&0x01)+48
             -);
 769   3      //      //lcd_wdat(24);lcd_wdat(25);
 770   3      //      lcd_wcmd(0x9a);
 771   3      //      lcd_wdat(MusicPlayerDat[2]/10+48);
 772   3      //      lcd_wdat(MusicPlayerDat[2]%10+48);
 773   3      
 774   3      
 775   3            if(RiPlaybackStatus==0)lcd_ch_display(3,4,"MODE:OFF");
 776   3            if(RiPlaybackStatus==1)lcd_ch_display(3,4,"MODE:ON ");
 777   3            if(RiPlaybackStatus==2)lcd_ch_display(3,4,"MODE:PAU");
 778   3            
 779   3            if(Jq_CheckPermission)
 780   3            {
 781   4              if(!(Jq_Counter_clock%3))//延迟
 782   4              {
 783   5                if((TiBUSY==0))
 784   5                {
 785   6                if(Jq_Counter==0)JqQueryCmd(0);//播放状态
 786   6                if(Jq_Counter==1)JqQueryCmd(1);//播放总时间
 787   6                if(Jq_Counter==2)JqQueryCmd(7);//当前曲目
 788   6                if(Jq_Counter<2)Jq_Counter++;else Jq_Counter=0;
 789   6                }
 790   5                else Jq_Shunt++;
 791   5                
 792   5                  
 793   5              }
 794   4              else if((TiBUSY==0)&&(Jq_Shunt>0))
 795   4              {
 796   5                if(Jq_Counter==0)JqQueryCmd(0);
 797   5                if(Jq_Counter==1)JqQueryCmd(1);
 798   5                if(Jq_Counter==2)JqQueryCmd(7);
 799   5                if(Jq_Counter<2)Jq_Counter++;
 800   5                Jq_Shunt--;
 801   5              }
 802   4            }
 803   3      //      if(Jq_SecOld!=RiCurrentPlayingTime[0])
 804   3      //      {
 805   3      //        Jq_SecOld==RiCurrentPlayingTime[0];
 806   3      //        Jq_Counter_clock=0;
 807   3      //      }
 808   3            Jq_Counter_clock++;
 809   3            break;
 810   3          }
 811   2          case 14:
 812   2          {
 813   3      if(menuRefreshSign!=menuCode){lcd_clr_DDram();lcd_clr_GD();menuRefreshSign=menuCode;JqSoundOption=10;DsHou
             -rOld=ds_dat_time[2];}
 814   3            lcd_ch_display(0,0,"声");
C51 COMPILER V9.60.0.0   ROT                                                               05/29/2020 16:57:55 PAGE 15  

 815   3            lcd_ch_display(1,0,"音");
 816   3            lcd_ch_display(2,0,"设");
 817   3            lcd_ch_display(3,0,"置");
 818   3            lcd_Draw_PM_dat2(0,0,1,64,0xff,0xfe);
 819   3            lcd_ch_display(0,1,"整点报时：");
 820   3            if(JqHourlyTimeSwitch)lcd_ch_display(0,6,"开");else lcd_ch_display(0,6,"关");
 821   3            lcd_ch_display(1,1,"闹铃曲目：");
 822   3            lcd_ch_display(2,1,"铃1:");lcd_ch_display(2,5,"铃2:");
 823   3            lcd_ch_display(3,1,"铃3:");lcd_ch_display(3,5,"铃4:");
 824   3            lcd_wcmd(0x30);
 825   3            lcd_wcmd(0x8b);lcd_wdat(AlarmClockMusicSet[0]/10+48);lcd_wdat(AlarmClockMusicSet[0]%10+48);
 826   3            lcd_wcmd(0x8f);lcd_wdat(AlarmClockMusicSet[1]/10+48);lcd_wdat(AlarmClockMusicSet[1]%10+48);
 827   3            lcd_wcmd(0x9b);lcd_wdat(AlarmClockMusicSet[2]/10+48);lcd_wdat(AlarmClockMusicSet[2]%10+48);
 828   3            lcd_wcmd(0x9f);lcd_wdat(AlarmClockMusicSet[3]/10+48);lcd_wdat(AlarmClockMusicSet[3]%10+48);
 829   3            if(JqSoundOptionOld!=JqSoundOption)
 830   3            {
 831   4              JqSoundOptionOld=JqSoundOption;
 832   4              lcd_Draw_PM_dat2(1,0,7,64,0x00,0x00);
 833   4            }
 834   3            if(JqSoundOptionOld<5)
 835   3              switch(JqSoundOptionOld)
 836   3              {
 837   4                case 0:lcd_Draw_PM_dat2(6,0,1,16,0xff,0xfe);break;
 838   4                case 1:lcd_Draw_PM_dat2(3,32,1,16,0xff,0xff);break;
 839   4                case 2:lcd_Draw_PM_dat2(7,32,1,16,0xff,0xff);break;
 840   4                case 3:lcd_Draw_PM_dat2(3,48,1,16,0xff,0xff);break;
 841   4                case 4:lcd_Draw_PM_dat2(7,48,1,16,0xff,0xff);break;
 842   4                default:break;
 843   4              }
 844   3            break;
 845   3          }
 846   2          case 15:
 847   2          {
 848   3            Clr_menuScreen
 849   3            if(menuRefreshSign!=menuCode){lcd_clr_DDram();lcd_clr_GD();menuRefreshSign=menuCode;}
 850   3            //lcd_Draw_PM(0,0,8,64,gImage_sias);
 851   3            lcd_Draw_PM_Any(0,0,64,64,gImage_sias);
 852   3            lcd_ch_display(0,4,"毕业设计");
 853   3            lcd_ch_display(1,4,"  万年历");
 854   3            lcd_ch_display(2,4," by:");
 855   3            lcd_ch_display(3,4," RorySpt");
 856   3            break;
 857   3          }
 858   2          case 16:
 859   2          {
 860   3            Clr_menuScreen
 861   3            switch(moreMenuCode)
 862   3            {
 863   4              case 1:
 864   4              {
 865   5                if(moreMenuRefreshSign!=moreMenuCode){lcd_clr_DDram();lcd_clr_GD();moreMenuRefreshSign=moreMenuCode;}
 866   5                //Clr_menuScreen
 867   5                lcd_ch_display(0,0,"附");
 868   5                lcd_ch_display(1,0,"加");
 869   5                lcd_ch_display(2,0,"功");
 870   5                lcd_ch_display(3,0,"能");
 871   5                lcd_Draw_PM_dat2(0,0,1,64,0xff,0xfe);
 872   5                lcd_ch_display(0,1,"贪吃蛇");
 873   5                switch(moreFunctionsOption)//光标
 874   5                {
 875   6                  case 0:lcd_Draw_PM_dat2(1,0,3,16,0xff,0xff);break;
 876   6                  default:break;
C51 COMPILER V9.60.0.0   ROT                                                               05/29/2020 16:57:55 PAGE 16  

 877   6                }
 878   5                break;
 879   5              }
 880   4              case 10:
 881   4              {
 882   5                if(moreMenuRefreshSign!=moreMenuCode){lcd_clr_DDram();lcd_clr_GD();moreMenuRefreshSign=moreMenuCode;}
 883   5                lcd_ch_display(0,0,"贪");
 884   5                lcd_ch_display(1,0,"吃");
 885   5                lcd_ch_display(2,0,"蛇");
 886   5                lcd_Draw_PM_dat2(0,0,1,48,0xff,0xfe);
 887   5                lcd_ch_display(0,1,"\xD5\xFD常模式");
 888   5                lcd_ch_display(1,1,"穿墙模式");
 889   5                lcd_ch_display(2,1,"挑战模式");
 890   5                lcd_ch_display(3,1,"游戏设置");
 891   5                
 892   5                if(gameSnakeOption!=gameSnakeOptionOld)
 893   5                {
 894   6                  
 895   6                  gameSnakeOptionOld=gameSnakeOption;
 896   6                  lcd_Draw_PM_dat2(1,0,7,64,0x00,0x00);
 897   6                }
 898   5                switch(gameSnakeOptionOld)
 899   5                {
 900   6                  case 0:lcd_Draw_PM_dat2(1,0,4,16,0xff,0xff);break;
 901   6                  case 1:lcd_Draw_PM_dat2(1,16,4,16,0xff,0xff);break;
 902   6                  case 2:lcd_Draw_PM_dat2(1,32,4,16,0xff,0xff);break;
 903   6                  case 3:lcd_Draw_PM_dat2(1,48,4,16,0xff,0xff);break;
 904   6                  default:break;
 905   6                }
 906   5      
 907   5                break;
 908   5              }
 909   4              case 100://正常模式
 910   4              {
 911   5                if(moreMenuRefreshSign!=moreMenuCode){lcd_clr_DDram();lcd_clr_GD();moreMenuRefreshSign=moreMenuCode;
 912   6                  rot_taskFrequency[4]=1;
 913   6                  for(i=0;i<96;i+=4)lcd_Draw_PM_Any_plus(i,0,4,4,PixelBlock4x4[11]);
 914   6                  for(i=0;i<96;i+=4)lcd_Draw_PM_Any_plus(i,60,4,4,PixelBlock4x4[11]);
 915   6                  for(j=4;j<60;j+=4)lcd_Draw_PM_Any_plus(0,j,4,4,PixelBlock4x4[11]);
 916   6                  for(j=4;j<60;j+=4)lcd_Draw_PM_Any_plus(92,j,4,4,PixelBlock4x4[11]);
 917   6                  srand(rot_timeBase);
 918   6                  
 919   6                  greedySnakeBody[0][0]=7;greedySnakeBody[0][1]=5;
 920   6                  greedySnakeBody[1][0]=7;greedySnakeBody[1][1]=4;
 921   6                  greedySnakeHead   [0]=7;greedySnakeHead   [1]=6;
 922   6                  GreedySnakeMovementDirection=0;
 923   6                  greedySnakeBodyLength=2;
 924   6                  //greedySnakeFeedUseNum=10;
 925   6                  greedySnake_feed_init();
 926   6                  greedySnake_feed();
 927   6                  for(i=0;i<greedySnakeFeedUseNum;i++)lcd_Draw_PM_Any_plus((greedySnakeFeedNum[i][1]+1)*4,(greedySnake
             -FeedNum[i][0]+1)*4,4,4,PixelBlock4x4[6]);
 928   6                  for(i=0;i<greedySnakeBodyLength;i++){lcd_Draw_PM_Any_plus((greedySnakeBody[i][1]+1)*4,(greedySnakeBo
             -dy[i][0]+1)*4,4,4,PixelBlock4x4[0]);}
 929   6                  lcd_Draw_PM_Any_plus((greedySnakeHead[1]+1)*4,(greedySnakeHead[0]+1)*4,4,4,PixelBlock4x4[2+GreedySna
             -keMovementDirection]);
 930   6                  
 931   6                  gamedatcache[0]=greedySnakeBody[greedySnakeBodyLength-1][0];
 932   6                  gamedatcache[1]=greedySnakeBody[greedySnakeBodyLength-1][1];
 933   6                }
 934   5                if(gametime>=gameSpeed)
 935   5                {
C51 COMPILER V9.60.0.0   ROT                                                               05/29/2020 16:57:55 PAGE 17  

 936   6                  gametime=0;
 937   6      
 938   6                  switch(k=greedySnake_move(0))
 939   6                  {
 940   7                    case 0:break;
 941   7                    case 1:/*lcd_Draw_PM_Any_plus((greedySnakeHead[1]+1)*4,(greedySnakeHead[0]+1)*4,4,4,PixelBlock4x4[7
             -+GreedySnakeMovementDirection]);*/
 942   7                      greedySnake_feed();for(i=0;i<greedySnakeFeedUseNum;i++)lcd_Draw_PM_Any_plus((greedySnakeFeedNum[i]
             -[1]+1)*4,(greedySnakeFeedNum[i][0]+1)*4,4,4,PixelBlock4x4[6]);break;
 943   7                    case 254:
 944   7                    case 255:moreMenuCode=210;break;
 945   7                    default : break;
 946   7                  }
 947   6      
 948   6                  
 949   6                  if(!k)lcd_Draw_PM_Any_plus((gamedatcache[1]+1)*4,(gamedatcache[0]+1)*4,4,4,kong);
 950   6                  gamedatcache[0]=greedySnakeBody[greedySnakeBodyLength-1][0];
 951   6                  gamedatcache[1]=greedySnakeBody[greedySnakeBodyLength-1][1];
 952   6                  lcd_Draw_PM_Any_plus((greedySnakeHead[1]+1)*4,(greedySnakeHead[0]+1)*4,4,4,PixelBlock4x4[2+GreedySna
             -keMovementDirection]);
 953   6                  lcd_Draw_PM_Any_plus((greedySnakeBody[0][1]+1)*4,(greedySnakeBody[0][0]+1)*4,4,4,PixelBlock4x4[0]);
 954   6                  //for(i=0;i<greedySnakeBodyLength;i++){lcd_Draw_PM_Any_plus((greedySnakeBody[i][1]+1)*4,(greedySnake
             -Body[i][0]+1)*4,4,4,PixelBlock4x4[0]);}
 955   6                  
 956   6                  
 957   6                  lcd_wcmd(0x30);
 958   6                  lcd_wcmd(0x86);
 959   6                  lcd_wdat((greedySnakeBodyLength-2)/1000%10+48);lcd_wdat((greedySnakeBodyLength-2)/100%10+48);
 960   6                  lcd_wdat((greedySnakeBodyLength-2)/10%10+48);lcd_wdat((greedySnakeBodyLength-2)%10+48);
 961   6      
 962   6                }
 963   5                
 964   5                gametime++;
 965   5                gameFPS_counter++;
 966   5                lcd_wcmd(0x30);lcd_wcmd(0x9f);
 967   5                lcd_wdat(gameFPS%100/10+48);lcd_wdat(gameFPS%10+48);
 968   5                break;
 969   5              }
 970   4              case 210:
 971   4              {
 972   5                if(moreMenuRefreshSign!=moreMenuCode){lcd_clr_DDram();lcd_clr_GD();moreMenuRefreshSign=moreMenuCode;}
 973   5                lcd_ch_display(0,2,"游戏结束");
 974   5                lcd_ch_display(1,2,"重新开始？");
 975   5                break;
 976   5              } 
 977   4              case 101:
 978   4              {
 979   5                if(moreMenuRefreshSign!=moreMenuCode){lcd_clr_DDram();lcd_clr_GD();moreMenuRefreshSign=moreMenuCode;
 980   6                  rot_taskFrequency[4]=1;
 981   6                  for(i=0;i<96;i+=4)lcd_Draw_PM_Any_plus(i,0,4,4,PixelBlock4x4[11]);
 982   6                  for(i=0;i<96;i+=4)lcd_Draw_PM_Any_plus(i,60,4,4,PixelBlock4x4[11]);
 983   6                  for(j=4;j<60;j+=4)lcd_Draw_PM_Any_plus(0,j,4,4,PixelBlock4x4[11]);
 984   6                  for(j=4;j<60;j+=4)lcd_Draw_PM_Any_plus(92,j,4,4,PixelBlock4x4[11]);
 985   6                  srand(rot_timeBase);
 986   6                  
 987   6                  greedySnakeBody[0][0]=7;greedySnakeBody[0][1]=5;
 988   6                  greedySnakeBody[1][0]=7;greedySnakeBody[1][1]=4;
 989   6                  greedySnakeHead   [0]=7;greedySnakeHead   [1]=6;
 990   6                  GreedySnakeMovementDirection=0;
 991   6                  greedySnakeBodyLength=2;
 992   6                //  greedySnakeFeedUseNum=1;
 993   6                  greedySnake_feed_init();
C51 COMPILER V9.60.0.0   ROT                                                               05/29/2020 16:57:55 PAGE 18  

 994   6                  greedySnake_feed();
 995   6                  for(i=0;i<greedySnakeFeedUseNum;i++)lcd_Draw_PM_Any_plus((greedySnakeFeedNum[i][1]+1)*4,(greedySnake
             -FeedNum[i][0]+1)*4,4,4,PixelBlock4x4[6]);
 996   6                  for(i=0;i<greedySnakeBodyLength;i++){lcd_Draw_PM_Any_plus((greedySnakeBody[i][1]+1)*4,(greedySnakeBo
             -dy[i][0]+1)*4,4,4,PixelBlock4x4[0]);}
 997   6                  lcd_Draw_PM_Any_plus((greedySnakeHead[1]+1)*4,(greedySnakeHead[0]+1)*4,4,4,PixelBlock4x4[2+GreedySna
             -keMovementDirection]);
 998   6                  
 999   6                  gamedatcache[0]=greedySnakeBody[greedySnakeBodyLength-1][0];
1000   6                  gamedatcache[1]=greedySnakeBody[greedySnakeBodyLength-1][1];
1001   6                }
1002   5                if(gametime>=gameSpeed)
1003   5                {
1004   6                  gametime=0;
1005   6      
1006   6                  switch(k=greedySnake_move(1))
1007   6                  {
1008   7                    case 0:break;
1009   7                    case 1:/*lcd_Draw_PM_Any_plus((greedySnakeHead[1]+1)*4,(greedySnakeHead[0]+1)*4,4,4,PixelBlock4x4[7
             -+GreedySnakeMovementDirection]);*/
1010   7                      greedySnake_feed();for(i=0;i<greedySnakeFeedUseNum;i++)lcd_Draw_PM_Any_plus((greedySnakeFeedNum[i]
             -[1]+1)*4,(greedySnakeFeedNum[i][0]+1)*4,4,4,PixelBlock4x4[6]);break;
1011   7                    case 254:
1012   7                    case 255:moreMenuCode=211;break;
1013   7                    default : break;
1014   7                  }
1015   6      
1016   6                  
1017   6                  if(!k)lcd_Draw_PM_Any_plus((gamedatcache[1]+1)*4,(gamedatcache[0]+1)*4,4,4,kong);
1018   6                  gamedatcache[0]=greedySnakeBody[greedySnakeBodyLength-1][0];
1019   6                  gamedatcache[1]=greedySnakeBody[greedySnakeBodyLength-1][1];
1020   6                  lcd_Draw_PM_Any_plus((greedySnakeHead[1]+1)*4,(greedySnakeHead[0]+1)*4,4,4,PixelBlock4x4[2+GreedySna
             -keMovementDirection]);
1021   6                  lcd_Draw_PM_Any_plus((greedySnakeBody[0][1]+1)*4,(greedySnakeBody[0][0]+1)*4,4,4,PixelBlock4x4[0]);
1022   6                  //for(i=0;i<greedySnakeBodyLength;i++){lcd_Draw_PM_Any_plus((greedySnakeBody[i][1]+1)*4,(greedySnake
             -Body[i][0]+1)*4,4,4,PixelBlock4x4[0]);}
1023   6                  
1024   6                  
1025   6                  lcd_wcmd(0x30);
1026   6                  lcd_wcmd(0x86);
1027   6                  lcd_wdat((greedySnakeBodyLength-2)/1000%10+48);lcd_wdat((greedySnakeBodyLength-2)/100%10+48);
1028   6                  lcd_wdat((greedySnakeBodyLength-2)/10%10+48);lcd_wdat((greedySnakeBodyLength-2)%10+48);
1029   6      
1030   6                }
1031   5                
1032   5                gametime++;
1033   5                gameFPS_counter++;
1034   5                lcd_wcmd(0x30);lcd_wcmd(0x9f);
1035   5                lcd_wdat(gameFPS%100/10+48);lcd_wdat(gameFPS%10+48);
1036   5                break;
1037   5              }
1038   4              case 211:
1039   4              {
1040   5                if(moreMenuRefreshSign!=moreMenuCode){lcd_clr_DDram();lcd_clr_GD();moreMenuRefreshSign=moreMenuCode;}
1041   5                lcd_ch_display(0,2,"游戏结束");
1042   5                lcd_ch_display(1,2,"重新开始？");
1043   5                break;
1044   5              } 
1045   4              case 103:
1046   4              {
1047   5                if(moreMenuRefreshSign!=moreMenuCode){lcd_clr_DDram();lcd_clr_GD();moreMenuRefreshSign=moreMenuCode;
1048   6                lcd_ch_display(0,0,"游");
C51 COMPILER V9.60.0.0   ROT                                                               05/29/2020 16:57:55 PAGE 19  

1049   6                lcd_ch_display(1,0,"戏");
1050   6                lcd_ch_display(2,0,"设");
1051   6                lcd_ch_display(3,0,"置");
1052   6                lcd_Draw_PM_dat2(0,0,1,64,0xff,0xfe);
1053   6                }
1054   5                lcd_ch_display(0,1,"食物\xCA\xFD量：");
1055   5                lcd_ch_display(1,1,"移动速度：");
1056   5                lcd_wcmd(0x30);
1057   5                lcd_wcmd(0x86);lcd_wdat(greedySnakeFeedUseNum/10%10+48);lcd_wdat(greedySnakeFeedUseNum%10+48);
1058   5                lcd_wcmd(0x96);lcd_wdat((10-gameSpeedSet)/10%10+48);lcd_wdat((10-gameSpeedSet)%10+48);
1059   5                if(gameSnakeSetOption!=gameSnakeSetOptionOld)
1060   5                {
1061   6                  gameSnakeSetOptionOld=gameSnakeSetOption;
1062   6                  lcd_Draw_PM_dat2(1,0,7,64,0x00,0x00);
1063   6                }
1064   5                switch(gameSnakeSetOption)
1065   5                {
1066   6                  case 0:lcd_Draw_PM_dat2(6,0,1,16,0xff,0xff);break;
1067   6                  case 1:lcd_Draw_PM_dat2(6,16,1,16,0xff,0xff);break;
1068   6                  default:break;
1069   6                }
1070   5              }
1071   4            }
1072   3            break;
1073   3          }
1074   2          
1075   2      //    case 161: 
1076   2      //    {
1077   2      //      if(menuRefreshSign!=menuCode){lcd_clr_DDram();lcd_clr_GD();menuRefreshSign=menuCode;
1078   2      //        rot_taskFrequency[4]=1;
1079   2      //        for(i=0;i<96;i+=4)lcd_Draw_PM_Any_plus(i,0,4,4,PixelBlock4x4[11]);
1080   2      //        for(i=0;i<96;i+=4)lcd_Draw_PM_Any_plus(i,60,4,4,PixelBlock4x4[11]);
1081   2      //        for(j=4;j<60;j+=4)lcd_Draw_PM_Any_plus(0,j,4,4,PixelBlock4x4[11]);
1082   2      //        for(j=4;j<60;j+=4)lcd_Draw_PM_Any_plus(92,j,4,4,PixelBlock4x4[11]);
1083   2      //        srand(rot_timeBase);
1084   2      //        greedySnakeBody[0][0]=7;greedySnakeBody[0][1]=5;
1085   2      //        greedySnakeBody[1][0]=7;greedySnakeBody[1][1]=4;
1086   2      //        greedySnakeHead   [0]=7;greedySnakeHead   [1]=6;
1087   2      //        GreedySnakeMovementDirection=0;
1088   2      //        greedySnakeBodyLength=2;
1089   2      //        greedySnake_feed(1);
1090   2      //        for(i=0;i<greedySnakeBodyLength;i++){lcd_Draw_PM_Any_plus((greedySnakeBody[i][1]+1)*4,(greedySnakeBo
             -dy[i][0]+1)*4,4,4,PixelBlock4x4[0]);}
1091   2      //        lcd_Draw_PM_Any_plus((greedySnakeHead[1]+1)*4,(greedySnakeHead[0]+1)*4,4,4,PixelBlock4x4[2+GreedySna
             -keMovementDirection]);
1092   2      //        
1093   2      //        gamedatcache[0]=greedySnakeBody[greedySnakeBodyLength-1][0];
1094   2      //        gamedatcache[1]=greedySnakeBody[greedySnakeBodyLength-1][1];
1095   2      //      }
1096   2      //      if(gametime>=gameSpeed)
1097   2      //      {
1098   2      //        gametime=0;
1099   2      //        //lcd_Draw_PM_dat2(0,0,8,64,0x00,0x00);
1100   2      ////        lcd_Draw_PM_Any_plus(4,4,88,56,kong);
1101   2      ////        lcd_Draw_PM_Any_plus((greedySnakeBody[greedySnakeBodyLength-1][1]+1)*4,(greedySnakeBody[greedySnak
             -eBodyLength-1][0]+1)*4,4,4,PixelBlock4x4[1]);
1102   2      //        //lcd_Draw_PM_Any_plus((greedySnakeBody[greedySnakeBodyLength-2][1]+1)*4,(greedySnakeBody[greedySnak
             -eBodyLength-2][0]+1)*4,4,4,kong);
1103   2      ////        for(i=0;i<96;i+=4)lcd_Draw_PM_Any_plus(i,0,4,4,PixelBlock4x4[0]);
1104   2      ////        for(i=0;i<96;i+=4)lcd_Draw_PM_Any_plus(i,60,4,4,PixelBlock4x4[0]);
1105   2      ////        for(j=4;j<60;j+=4)lcd_Draw_PM_Any_plus(0,j,4,4,PixelBlock4x4[0]);
1106   2      ////        for(j=4;j<60;j+=4)lcd_Draw_PM_Any_plus(92,j,4,4,PixelBlock4x4[0]);
C51 COMPILER V9.60.0.0   ROT                                                               05/29/2020 16:57:55 PAGE 20  

1107   2      //        switch(k=greedySnake_move())
1108   2      //        {
1109   2      //          case 0:break;
1110   2      //          case 1:/*lcd_Draw_PM_Any_plus((greedySnakeHead[1]+1)*4,(greedySnakeHead[0]+1)*4,4,4,PixelBlock4x4[7
             -+GreedySnakeMovementDirection]);*/greedySnake_feed(1);break;
1111   2      //          case 254:
1112   2      //          case 255:menuCode=169;break;
1113   2      //          default : break;
1114   2      //        }
1115   2      ////        lcd_wcmd(0x30);
1116   2      ////        lcd_wcmd(0x96);
1117   2      ////        lcd_wdat(gamedatcache[0]/10+48);lcd_wdat(gamedatcache[0]%10+48);
1118   2      ////        lcd_wdat(gamedatcache[1]/10+48);lcd_wdat(gamedatcache[1]%10+48);
1119   2      ////        lcd_wcmd(0x9e);
1120   2      ////        lcd_wdat(greedySnakeBody[greedySnakeBodyLength-1][0]/10+48);lcd_wdat(greedySnakeBody[greedySnakeBo
             -dyLength-1][0]%10+48);
1121   2      ////        lcd_wdat(greedySnakeBody[greedySnakeBodyLength-1][1]/10+48);lcd_wdat(greedySnakeBody[greedySnakeBo
             -dyLength-1][1]%10+48);
1122   2      //        
1123   2      //        if(!k)lcd_Draw_PM_Any_plus((gamedatcache[1]+1)*4,(gamedatcache[0]+1)*4,4,4,kong);
1124   2      //        gamedatcache[0]=greedySnakeBody[greedySnakeBodyLength-1][0];
1125   2      //        gamedatcache[1]=greedySnakeBody[greedySnakeBodyLength-1][1];
1126   2      //        lcd_Draw_PM_Any_plus((greedySnakeHead[1]+1)*4,(greedySnakeHead[0]+1)*4,4,4,PixelBlock4x4[2+GreedySna
             -keMovementDirection]);
1127   2      //        lcd_Draw_PM_Any_plus((greedySnakeBody[0][1]+1)*4,(greedySnakeBody[0][0]+1)*4,4,4,PixelBlock4x4[0]);
1128   2      //        //for(i=0;i<greedySnakeBodyLength;i++){lcd_Draw_PM_Any_plus((greedySnakeBody[i][1]+1)*4,(greedySnake
             -Body[i][0]+1)*4,4,4,PixelBlock4x4[0]);}
1129   2      //        lcd_Draw_PM_Any_plus((greedySnakeFeedNum[0][1]+1)*4,(greedySnakeFeedNum[0][0]+1)*4,4,4,PixelBlock4x4
             -[6]);
1130   2      //        
1131   2      //        lcd_wcmd(0x30);
1132   2      //        lcd_wcmd(0x86);
1133   2      //        lcd_wdat((greedySnakeBodyLength-2)/1000%10+48);lcd_wdat((greedySnakeBodyLength-2)/100%10+48);
1134   2      //        lcd_wdat((greedySnakeBodyLength-2)/10%10+48);lcd_wdat((greedySnakeBodyLength-2)%10+48);
1135   2      ////        lcd_wdat(greedySnakeBody[0][0]/10+48);lcd_wdat(greedySnakeBody[0][0]%10+48);
1136   2      ////        lcd_wdat(greedySnakeBody[0][1]/10+48);lcd_wdat(greedySnakeBody[0][1]%10+48);
1137   2      ////        lcd_wcmd(0x96);lcd_wdat(greedySnakeBody[1][0]/10+48);lcd_wdat(greedySnakeBody[1][0]%10+48);
1138   2      ////        lcd_wdat(greedySnakeBody[1][1]/10+48);lcd_wdat(greedySnakeBody[1][1]%10+48);
1139   2      ////        lcd_wcmd(0x8e);lcd_wdat(greedySnakeHead[0]/10+48);lcd_wdat(greedySnakeHead[0]%10+48);
1140   2      ////        lcd_wdat(greedySnakeHead[1]/10+48);lcd_wdat(greedySnakeHead[1]%10+48);
1141   2      ////        lcd_wcmd(0x9e);lcd_wdat(greedySnakeFeedNum[0][0]/10+48);lcd_wdat(greedySnakeFeedNum[0][0]%10+48);
1142   2      ////        lcd_wdat(greedySnakeFeedNum[0][1]/10+48);lcd_wdat(greedySnakeFeedNum[0][1]%10+48);
1143   2      //      }
1144   2      //      
1145   2      //      gametime++;
1146   2      //      gameFPS_counter++;
1147   2      //      lcd_wcmd(0x30);lcd_wcmd(0x9f);
1148   2      //      lcd_wdat(gameFPS%100/10+48);lcd_wdat(gameFPS%10+48);
1149   2      //      break;
1150   2      //    }
1151   2        
1152   2          case 255:
1153   2          {
1154   3            if(menuRefreshSign!=menuCode){lcd_clr_DDram();lcd_clr_GD();menuRefreshSign=menuCode;}
1155   3            if(BootInterfaceDisplayTime>40)lcd_Draw_PM_Any(32,0,64,64,gImage_sias);
1156   3            if(BootInterfaceDisplayTime<40)
1157   3            {
1158   4              if(BootInterfaceDisplayTime>28)lcd_Draw_PM_Any((BootInterfaceDisplayTime-29)*3,0,64,64,gImage_sias);
1159   4              
1160   4              if(BootInterfaceDisplayTime<25)
1161   4              {
1162   5                lcd_ch_display(0,4,"毕业设计");
C51 COMPILER V9.60.0.0   ROT                                                               05/29/2020 16:57:55 PAGE 21  

1163   5                lcd_ch_display(1,4,"  万年历");
1164   5                lcd_ch_display(2,4," by:");
1165   5                lcd_ch_display(3,4," RorySpt");
1166   5              }
1167   4            }
1168   3      
1169   3            BootInterfaceDisplayTime--;
1170   3            if(!BootInterfaceDisplayTime)menuCode=0;
1171   3            break;
1172   3          }
1173   2        }   
1174   1      }
1175          
1176          //This is for test!
1177          //{
1178          //  uchar i,j;
1179          //  lcd_init();
1180          
1181          //    
1182          //    lcd_wcmd(0x80);
1183          //    lcd_wdat((ds_dat_time[2]>>4)+48);lcd_wdat((ds_dat_time[2]&0x0f)+48);//时
1184          //    lcd_wdat('/');
1185          //    lcd_wdat((ds_dat_time[1]>>4)+48);lcd_wdat((ds_dat_time[1]&0x0f)+48);//分
1186          //    lcd_wdat('/');
1187          //    lcd_wdat(((ds_dat_time[0])>>4)+48);lcd_wdat((ds_dat_time[0]&0x0f)+48);//秒
1188          //  
1189          //    lcd_wcmd(0x84);
1190          //    lcd_wdat((moon_year>>4)+48);lcd_wdat((moon_year&0x0f)+48);//阴历
1191          //    lcd_wdat('/');
1192          //    lcd_wdat((moon_month>>4)+48);lcd_wdat((moon_month&0x0f)+48);
1193          //    lcd_wdat('/');
1194          //    lcd_wdat(((moon_day)>>4)+48);lcd_wdat((moon_day&0x0f)+48);
1195          //    
1196          //    lcd_wcmd(0x94);
1197          //    lcd_wdat((ds_dat_time[6]>>4)+48);lcd_wdat((ds_dat_time[6]&0x0f)+48);//阳历
1198          //    lcd_wdat('/');
1199          //    lcd_wdat((ds_dat_time[4]>>4)+48);lcd_wdat((ds_dat_time[4]&0x0f)+48);
1200          //    lcd_wdat('/');
1201          //    lcd_wdat(((ds_dat_time[3])>>4)+48);lcd_wdat((ds_dat_time[3]&0x0f)+48);
1202          //    
1203          //    //i=CalculateWeek(20,((ds_dat_time[6]>>4)+(ds_dat_time[6]&0x0f)),((ds_dat_time[4]>>4)+(ds_dat_time[4]&
             -0x0f)), ((ds_dat_time[3]>>4)+(ds_dat_time[3]&0x0f)));
1204          //    i=CalculateWeek(century,ds_dat_time[6],ds_dat_time[4],ds_dat_time[3]);
1205          //    lcd_wcmd(0x90);
1206          //    lcd_wdat(i+48);lcd_wdat(' ');
1207          ////    lcd_wcmd(0x94);
1208          ////    lcd_wdat(Double_Press_counter[0]/10/100+48);
1209          ////    lcd_wdat(Double_Press_counter[0]/100%10+48);
1210          ////    lcd_wdat(Double_Press_counter[0]/10%10+48);
1211          ////    lcd_wdat(Double_Press_counter[0]%10+48);
1212          //  
1213          //  for(i=0;i<4;i++)
1214          //    {
1215          //      lcd_wcmd((0x88+i*4)*(i<2)+(0x98+(i-2)*4)*(i>=2));
1216          //      for(j=0;j<4;j++)
1217          //        lcd_wdat(ver_key[i][j]);
1218          //      lcd_wdat(' ');
1219          //      switch(Instruction_code_key[i])
1220          //      {
1221          //        case 0x80:lcd_wdat('0');break;
1222          //        case 0x81:lcd_wdat('1');break;
1223          //        case 0x82:if(Double_Press_counter[i]>2)lcd_wdat('2');else lcd_wdat('0');break;
C51 COMPILER V9.60.0.0   ROT                                                               05/29/2020 16:57:55 PAGE 22  

1224          //        case 0x83:if(Double_Press_counter[i]>2)lcd_wdat('3');else lcd_wdat('1');break;
1225          //        default  :lcd_wdat('4');break;
1226          //      }
1227          //      lcd_wdat(' ');lcd_wdat(' ');
1228          //    }
1229          //}
1230          
1231          uchar rot_task0()   //温度
1232          {
1233   1         if(task0_operating_status==0){EA=0;Ds18b20_ChangTemp();task0_operating_status=1;EA=1;}
1234   1         if(task0_operating_status==2){EA=0;Ds18b20_rTemp();temp_data_collation();task0_operating_status=0;EA=1;}
1235   1        //Ds18b20_ChangTemp();Ds18b20_rTemp();temp_data_collation();
1236   1        return 0;
1237   1      }
1238          void  rot_task1(){if(Sensor_switch[1]){EA=0;dht_rdat();EA=1;}}  //湿度
1239          void  rot_task2(){Ds1302_Read_time(); } //时间
1240          void  rot_task3(){if(Sensor_switch[0])Calculation();} //数据计算
1241          void  rot_task4(){screenOutput();}  //显示
1242          void  rot_task5(){AlarmClock_trigger();}  //闹钟
1243          //void  rot_task6(){MusicPlayer();}
1244          
1245          void rot_taskSchedule() //任务调度器
1246          {
1247   1        if(rot_taskTrigger[0]){rot_taskTrigger[0]=rot_task0();}//rot_taskTrigger[0]=rot_task0();程序可连续执行
1248   1        if(rot_taskTrigger[1]){rot_task1();rot_taskTrigger[1]=0;}
1249   1        if(rot_taskTrigger[2]){rot_task2();rot_taskTrigger[2]=0;}
1250   1        if(rot_taskTrigger[3]){rot_task3();rot_taskTrigger[3]=0;}
1251   1        if(rot_taskTrigger[4]){rot_task4();rot_taskTrigger[4]=0;}
1252   1        if(rot_taskTrigger[5]){rot_task5();rot_taskTrigger[5]=0;}
1253   1        //if(rot_taskTrigger[6]){rot_task6();rot_taskTrigger[6]=0;}
1254   1      }
1255          void rot_T0_time() interrupt 1
1256          {
1257   1        uchar data i;
1258   1        //TMOD=0x01;
1259   1        TL0 = 0x00;   //设置定时初值
1260   1        TH0 = 0xB8;   //设置定时初值
1261   1        if((rot_timeBase++)>10000)  rot_timeBase=1;//时基，10ms
1262   1        if(!(rot_timeBase%5))   recognition_key();  //每5*10ms触发一次
1263   1        for(i=0;i<tasksTotalNum;i++)if(rot_taskTrigger[i]==0)if((rot_taskCounter[i]++)>rot_taskFrequency[i]){rot_
             -taskCounter[i]=0;rot_taskTrigger[i]=1;}//定时任务触发器
1264   1        //if((task0_operating_status>0)&&(task0_operating_status<15))task0_operating_status++;else task0_operatin
             -g_status=0;
1265   1      
1266   1        if(task0_operating_status==1){            //任务0分步。任务触发之后100ms再次触发一次。
1267   2          if((task0_operating_status_timing++)<10);
1268   2          else {task0_operating_status_timing=0;task0_operating_status=2;rot_taskTrigger[0]=1;}
1269   2          }
1270   1        
1271   1        //if(!(rot_timeBase%Sensor_display_switchingSpeed))   if(SwitchFlag[0]<1)SwitchFlag[0]++;else if(Sensor_sw
             -itch[0])SwitchFlag[0]=0;else SwitchFlag[0]=1;   //定时切换
1272   1          if(!Sensor_display_switchingTimer){   if(SwitchFlag[0]<1)SwitchFlag[0]++;else if(Sensor_switch[0])SwitchF
             -lag[0]=0;else SwitchFlag[0]=1;Sensor_display_switchingTimer=Sensor_display_switchingSpeed;  } //定时切换
1273   1          else Sensor_display_switchingTimer--;
1274   1        //if(!(rot_timeBase%400))   if(SwitchFlag[1]<1)SwitchFlag[1]++;else SwitchFlag[1]=0;
1275   1        if(AlarmDat[0][0]>1){if(!(clock_time_delay[0]%300)){JqPlaySpecifiedTrack(AlarmClockMusicSet[0]);clock_tim
             -e_delay[0]++;}if(!(rot_timeBase%100))clock_time_delay[0]++;if(clock_time_delay[0]>3600)AlarmDat[0][0]-=2;}  //四个闹钟触
             -⑹背た刂
1276   1        if(AlarmDat[1][0]>1){if(!(clock_time_delay[1]%300)){JqPlaySpecifiedTrack(AlarmClockMusicSet[1]);clock_tim
             -e_delay[1]++;}if(!(rot_timeBase%100))clock_time_delay[1]++;if(clock_time_delay[1]>3600)AlarmDat[1][0]-=2;}
1277   1        if(AlarmDat[2][0]>1){if(!(clock_time_delay[2]%300)){JqPlaySpecifiedTrack(AlarmClockMusicSet[2]);clock_tim
             -e_delay[2]++;}if(!(rot_timeBase%100))clock_time_delay[2]++;if(clock_time_delay[2]>3600)AlarmDat[2][0]-=2;}
C51 COMPILER V9.60.0.0   ROT                                                               05/29/2020 16:57:55 PAGE 23  

1278   1        if(AlarmDat[3][0]>1){if(!(clock_time_delay[3]%300)){JqPlaySpecifiedTrack(AlarmClockMusicSet[3]);clock_tim
             -e_delay[3]++;}if(!(rot_timeBase%100))clock_time_delay[3]++;if(clock_time_delay[3]>3600)AlarmDat[3][0]-=2;}
1279   1        
1280   1        if(menuCode==13)//防止接收时序重叠
1281   1        {
1282   2          if(Jq_SecOld!=RiCurrentPlayingTime[2])
1283   2          {
1284   3            Jq_SecOld=RiCurrentPlayingTime[2];
1285   3            Jq_Counter_clock2=0;
1286   3            Jq_IntelligentErrorCorrectionCount=0;
1287   3          }
1288   2          
1289   2      //************智能检错纠错**********************************************************
1290   2      //作用：对秒的自动预测，以弥补uart通讯丢帧造成的播放时间跳动
1291   2      //使用变量：Jq_SmartCorrection_Sec,Jq_IntelligentErrorCorrectionCount;
1292   2      //引入可能造成的不良后果：如果播放器长时间没响应，秒会自动一直走到59并卡住，当播放器
1293   2      //反应过来后又会跳回正确的时间。
1294   2      //**********************************************************************************
1295   2          else if((Jq_SmartCorrection_Sec>0)&&(Jq_SmartCorrection_Sec!=RiTotalTrackTlaybackTime[2])&&(RiPlaybackSt
             -atus==1))
1296   2          {
1297   3            Jq_IntelligentErrorCorrectionCount++;
1298   3            if(Jq_IntelligentErrorCorrectionCount>100){if(Jq_SmartCorrection_Sec<59)Jq_SmartCorrection_Sec++;Jq_Int
             -elligentErrorCorrectionCount=0;}
1299   3          }
1300   2          if(!(KEY0&KEY1&KEY2&KEY3))Jq_IntelligentErrorCorrectionCount=0;
1301   2      //**********************************************************************************
1302   2          
1303   2          Jq_Counter_clock2++;
1304   2          if((Jq_Counter_clock2<105)&&(Jq_Counter_clock2>85))Jq_CheckPermission=0;
1305   2          else Jq_CheckPermission=1;
1306   2      
1307   2        }
1308   1      //  //音乐
1309   1      //  if(menuCode!=13){rot_taskTrigger[6]=0;}
1310   1        
1311   1      //整点报时
1312   1        if(JqHourlyTimeSwitch)
1313   1        {
1314   2          if(DsHourOld!=ds_dat_time[2]){DsHourOld=ds_dat_time[2];Tell_theTime();}
1315   2        }
1316   1        if(menuCode==16)if(rot_timeBase%100==0)
1317   1        {
1318   2          gameFPS=gameFPS_counter;
1319   2          gameFPS_counter=0;
1320   2        }
1321   1      }
1322          
1323          //void rot_os()
1324          //{
1325          //  
1326          //}


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =  16458    ----
   CONSTANT SIZE    =    819    ----
   XDATA SIZE       =    168       6
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      1       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
C51 COMPILER V9.60.0.0   ROT                                                               05/29/2020 16:57:55 PAGE 24  

   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
